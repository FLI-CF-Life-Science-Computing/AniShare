%% Generated by Sphinx.
\def\sphinxdocclass{report}
\documentclass[letterpaper,10pt,openany,oneside,english]{sphinxmanual}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax

\PassOptionsToPackage{warn}{textcomp}
\usepackage[utf8]{inputenc}
\ifdefined\DeclareUnicodeCharacter
 \ifdefined\DeclareUnicodeCharacterAsOptional
  \DeclareUnicodeCharacter{"00A0}{\nobreakspace}
  \DeclareUnicodeCharacter{"2500}{\sphinxunichar{2500}}
  \DeclareUnicodeCharacter{"2502}{\sphinxunichar{2502}}
  \DeclareUnicodeCharacter{"2514}{\sphinxunichar{2514}}
  \DeclareUnicodeCharacter{"251C}{\sphinxunichar{251C}}
  \DeclareUnicodeCharacter{"2572}{\textbackslash}
 \else
  \DeclareUnicodeCharacter{00A0}{\nobreakspace}
  \DeclareUnicodeCharacter{2500}{\sphinxunichar{2500}}
  \DeclareUnicodeCharacter{2502}{\sphinxunichar{2502}}
  \DeclareUnicodeCharacter{2514}{\sphinxunichar{2514}}
  \DeclareUnicodeCharacter{251C}{\sphinxunichar{251C}}
  \DeclareUnicodeCharacter{2572}{\textbackslash}
 \fi
\fi
\usepackage{cmap}
\usepackage[T1]{fontenc}
\usepackage{amsmath,amssymb,amstext}
\usepackage[english]{babel}
\usepackage{times}
\usepackage[Lenny]{fncychap}
\usepackage{sphinx}

\usepackage{geometry}

% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}
\addto\captionsenglish{\renewcommand{\contentsname}{Contents:}}

\addto\captionsenglish{\renewcommand{\figurename}{Fig.}}
\addto\captionsenglish{\renewcommand{\tablename}{Table}}
\addto\captionsenglish{\renewcommand{\literalblockname}{Listing}}

\addto\captionsenglish{\renewcommand{\literalblockcontinuedname}{continued from previous page}}
\addto\captionsenglish{\renewcommand{\literalblockcontinuesname}{continues on next page}}

\addto\extrasenglish{\def\pageautorefname{page}}

\setcounter{tocdepth}{1}



\title{anishare Documentation}
\date{Jun 06, 2018}
\release{1.1}
\author{Holger Dinkel}
\newcommand{\sphinxlogo}{\vbox{}}
\renewcommand{\releasename}{Release}
\makeindex

\begin{document}

\maketitle
\sphinxtableofcontents
\phantomsection\label{\detokenize{index::doc}}



\chapter{Introduction}
\label{\detokenize{index:introduction}}
\sphinxstylestrong{anishare} is a webservice for research institutes to share animals with the goal to re-use
animals and thus minimize total animal usage.

It has been developed at the \sphinxhref{http://leibniz-fli.de}{Leibniz institute for aging research} in
Jena. This django app is meant to be used by researchers who want to share research animals with
their colleagues. The basic idea is that animals are bred for experiments; however, sometimes, not
all parts of the animal are used or sometimes an experiment gets cancelled for whatever reason. By
sharing animals within the institute, less animals in total have to be sacrificed for research.

Anishare is a simple database of animals offered for reuse and a easy way to claim an animal with
automatic generation of email messages as well as an RSS feed for updates.

\noindent\sphinxincludegraphics{{anishare_index}.png}

At the moment, the software/database is geared towards handling of mice, however, it can be adjusted
to handle any kind of research animal.


\chapter{Using the software}
\label{\detokenize{index:using-the-software}}
\noindent\sphinxincludegraphics{{anishare_index_highlight}.png}

The webservice is split in two parts: The \sphinxstylestrong{animal input} method is via the Django Admin interface (See link
“Add Animal” top right) and is meant for \sphinxstyleemphasis{animal managers} only.
The \sphinxstylestrong{claim} method is via the normal web interface and is meant for normal users (who need to be
authenticated, though).


\section{Main user interface}
\label{\detokenize{index:main-user-interface}}

\subsection{Animals}
\label{\detokenize{index:animals}}
The main user-facing site is the list of animals to be shared. A user can browse this list, sort it
via the headers or search for a term using the search bar.

\noindent\sphinxincludegraphics{{anishare_index}.png}

If a user is interested in an animal, they should click on the button “Claim” which will bring up
another page (see below) in which they can review their claim before finally submitting. When they
click on “Yes, I want to claim this!”, then they will be entered as \sphinxstyleemphasis{new owner} of this animal and
an email will be send to them as well as the responsible/contact person informing them about this
transaction. Further steps might need to be necessary such as transferring the animal in the LIMS
(eg. PyRat).

\begin{sphinxadmonition}{note}{Note:}
If more than one animal is available, the user can adjust the number they want to claim.
The remaining animals will still be available for claim.
\end{sphinxadmonition}

\noindent\sphinxincludegraphics{{anishare_claim}.png}


\subsection{Organs}
\label{\detokenize{index:organs}}
There exists an individual page for animal organ share. It is very similar to the animal page,
however only individual organs are for offer. Also there is no availability period, but a day at
which the animal gets sacrificed. The person responsible for killing the animal will be informed via
email if anybody claims some of the available organs. The entry will remain available to others (as
they might want to claim other organs).

Organ index view:

\noindent\sphinxincludegraphics{{organs_index}.png}

Organ claim view:

\noindent\sphinxincludegraphics{{organs_claim}.png}


\subsection{RSS Feed}
\label{\detokenize{index:rss-feed}}
An RSS feed containing the latest ten animals and organs is automatically generated and can be found at
\sphinxtitleref{/animals/feed}. Users can subscribe (Most email clients allow the subscription
to RSS feeds) to this feed to stay up-to-date with the animal catalogue. By clicking on a link in
the feed, they are directed to the claim page of the individual animal/organ.

\noindent\sphinxincludegraphics[width=0.500\linewidth]{{anishare_rss_feed}.png}


\section{Main animal manager tasks}
\label{\detokenize{index:main-animal-manager-tasks}}
An \sphinxstyleemphasis{animal manager} can add animals and organs to the database.

\noindent\sphinxincludegraphics[width=0.600\linewidth]{{admin_overview_manager}.png}


\subsection{Animals}
\label{\detokenize{index:id1}}
Click on \sphinxcode{\sphinxupquote{Animals}} -\textgreater{} \sphinxcode{\sphinxupquote{Add}} to add an animal.

\noindent\sphinxincludegraphics[width=0.400\linewidth]{{admin_add_animal}.png}

All fields in bold \sphinxstylestrong{need} to be filled in, the others are optional.

After adding several animals, the main (index) view should look like this:

\noindent\sphinxincludegraphics{{admin_after_loaddata}.png}


\subsection{Organs}
\label{\detokenize{index:id2}}
Click on \sphinxcode{\sphinxupquote{Organs}} -\textgreater{} \sphinxcode{\sphinxupquote{Add}} to add an organ.

\noindent\sphinxincludegraphics[width=0.400\linewidth]{{admin_add_organ}.png}

All fields in bold \sphinxstylestrong{need} to be filled in, the others are optional.


\section{Main admin tasks}
\label{\detokenize{index:main-admin-tasks}}
The admin interface allows to edit the following types of entries:

\noindent\sphinxincludegraphics[width=0.600\linewidth]{{admin_overview}.png}


\subsection{Animals}
\label{\detokenize{index:id3}}
The main category to administer are animals to share.
Here, several filters (such as “sex”, “location”, etc.) are available to search for any set of animals.

\noindent\sphinxincludegraphics{{admin_animals}.png}

\begin{sphinxadmonition}{note}{Note:}
in order to remove a claim (thus making the animal available again), either click on an animal
and remove the email address from the field “new owner”, or select one or multiple animals and
select the “clear claim” \sphinxstyleemphasis{Action} and click “Go”.
\end{sphinxadmonition}

\begin{sphinxadmonition}{note}{Note:}
Once created, an animal cannot be deleted, except by the administrator.
\end{sphinxadmonition}


\subsection{Labs}
\label{\detokenize{index:labs}}
Labs are research labs/research groups and need to have at least one responsible/contact person each

\noindent\sphinxincludegraphics[width=0.600\linewidth]{{admin_labs}.png}

\begin{sphinxadmonition}{note}{Note:}
Only \sphinxstyleemphasis{administrators} are allowed to see and change Labs
\end{sphinxadmonition}


\subsection{Locations}
\label{\detokenize{index:locations}}
Locations are where animals are stored. Usually something like room numbers or “animal house” or “fish facility”.

\noindent\sphinxincludegraphics[width=0.600\linewidth]{{admin_locations}.png}

\begin{sphinxadmonition}{note}{Note:}
Only \sphinxstyleemphasis{administrators} are allowed to see and change Locations
\end{sphinxadmonition}


\subsection{Persons}
\label{\detokenize{index:persons}}
Persons responsible for the animals. Could be a vet or similar.
Every animal needs to have a responsible person associated to them. This person then gets
an email when the animal is being claimed.

\noindent\sphinxincludegraphics{{admin_persons}.png}

\begin{sphinxadmonition}{note}{Note:}
Only \sphinxstyleemphasis{administrators} are allowed to see and change Persons
\end{sphinxadmonition}


\subsection{Make a user an animal manager}
\label{\detokenize{index:make-a-user-an-animal-manager}}
In order to be able to add/edit animals, a user has to be in the group \sphinxstyleemphasis{animal manager} and have
\sphinxstyleemphasis{staff status} in django admin. For this, an \sphinxstyleemphasis{administrator} has to go to the \sphinxhref{https://anishare.leibniz-fli.de/admin/auth/user/}{user management} in the admin interface by clicking “Home” -\textgreater{} “Authentication and
Authorization” -\textgreater{} “Users”. Here, they can make a \sphinxstyleemphasis{user} an \sphinxstyleemphasis{animal manager}, by setting these values (\sphinxstyleemphasis{staff}
and group \sphinxstyleemphasis{animal manager}):

\noindent\sphinxincludegraphics[width=0.750\linewidth]{{admin_permissions_user}.png}


\chapter{Installation}
\label{\detokenize{index:installation}}

\section{Requirements}
\label{\detokenize{index:requirements}}
We use the latest version of \sphinxhref{https://www.djangoproject.com}{django}, which requires \sphinxhref{https://www.python.org}{python3}.
Install django and other dependancies (see file requirements.txt. We recommend using a virtual environment for this):

\fvset{hllines={, ,}}%
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{virtualenv} \PYG{o}{\PYGZhy{}}\PYG{n}{p} \PYG{n}{python3} \PYG{o}{.}
\PYG{n}{source} \PYG{n+nb}{bin}\PYG{o}{/}\PYG{n}{activate}
\PYG{n}{pip} \PYG{n}{install} \PYG{o}{\PYGZhy{}}\PYG{n}{r} \PYG{n}{requirements}\PYG{o}{.}\PYG{n}{txt}
\end{sphinxVerbatim}


\section{First time setup}
\label{\detokenize{index:first-time-setup}}
First, in the folder \sphinxcode{\sphinxupquote{anishare}}, copy the file \sphinxcode{\sphinxupquote{local\_settings.py.template}}
to \sphinxcode{\sphinxupquote{local\_settings.py}} and fill it in. If you want to use LDAP, comment in
the respective lines. Most importantly, you should configure the following lines:

\fvset{hllines={, ,}}%
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{EMAIL\PYGZus{}HOST} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{SECRET\PYGZus{}KEY} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{ALLOWED\PYGZus{}HOSTS} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{127.0.0.1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{]}
\end{sphinxVerbatim}

Then, you can run migrations:

\fvset{hllines={, ,}}%
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{python} \PYG{n}{manage}\PYG{o}{.}\PYG{n}{py} \PYG{n}{migrate}
\end{sphinxVerbatim}

\begin{sphinxadmonition}{note}{Note:}
This will create the sqlite database \sphinxcode{\sphinxupquote{db.sqlite3}} containing all the models
(eg. tables) as defined in \sphinxcode{\sphinxupquote{animals.models}}.
\end{sphinxadmonition}

Now create a superuser:

\fvset{hllines={, ,}}%
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{python} \PYG{n}{manage}\PYG{o}{.}\PYG{n}{py} \PYG{n}{createsuperuser}
\end{sphinxVerbatim}

You are now able to login to the admin interface, but first run the dev server:

\fvset{hllines={, ,}}%
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{python} \PYG{n}{manage}\PYG{o}{.}\PYG{n}{py} \PYG{n}{runserver}
\end{sphinxVerbatim}

This will listen on \sphinxcode{\sphinxupquote{http://localhost:8000}}, so browse to the admin page
\sphinxcode{\sphinxupquote{http://localhost:8000/admin}} and you should see this after login:

\noindent\sphinxincludegraphics{{admin_empty}.png}

You can also import a dummy set of data using the \sphinxcode{\sphinxupquote{loaddata}} command:

\fvset{hllines={, ,}}%
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{python} \PYG{n}{manage}\PYG{o}{.}\PYG{n}{py} \PYG{n}{loaddata} \PYG{n}{initial\PYGZus{}data}\PYG{o}{.}\PYG{n}{json}
\end{sphinxVerbatim}

After loading the data, the main admin interface should look like this:

\noindent\sphinxincludegraphics{{admin_after_loaddata}.png}


\section{Importing existing data}
\label{\detokenize{index:importing-existing-data}}
For import of existing data in tabular (excel) format, a management command is available at
\sphinxcode{\sphinxupquote{animals.models}}.
\sphinxcode{\sphinxupquote{animals.management.commands.import\_animals}}

\fvset{hllines={, ,}}%
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{python} \PYG{n}{manage}\PYG{o}{.}\PYG{n}{py} \PYG{n}{import\PYGZus{}animals}
\end{sphinxVerbatim}

\begin{sphinxadmonition}{note}{Note:}
See the file \sphinxcode{\sphinxupquote{example\_import.xls}} for an example…
\end{sphinxadmonition}

\noindent\sphinxincludegraphics{{import_excel_sheet}.png}


\section{Running Tests}
\label{\detokenize{index:running-tests}}
Tests reside in \sphinxcode{\sphinxupquote{animals/tests.py}}.
You can invoke the django tests like so:

\fvset{hllines={, ,}}%
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{python} \PYG{n}{manage}\PYG{o}{.}\PYG{n}{py} \PYG{n}{test}
\end{sphinxVerbatim}

\fvset{hllines={, ,}}%
\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{Tests for Anishare website}
\PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{k+kn}{from} \PYG{n+nn}{django.test} \PYG{k+kn}{import} \PYG{n}{TestCase}\PYG{p}{,} \PYG{n}{Client}
\PYG{k+kn}{from} \PYG{n+nn}{django.contrib.auth.models} \PYG{k+kn}{import} \PYG{n}{User}
\PYG{k+kn}{from} \PYG{n+nn}{django.core.management} \PYG{k+kn}{import} \PYG{n}{call\PYGZus{}command}

\PYG{k}{class} \PYG{n+nc}{GetAnimalsTest}\PYG{p}{(}\PYG{n}{TestCase}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    Test module to GET Animal pages}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}

    \PYG{k}{def} \PYG{n+nf}{setUp}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{)}\PYG{p}{:}
        \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{} Creating a user first and loading fixtures\PYGZdq{}\PYGZdq{}\PYGZdq{}}
        \PYG{n}{call\PYGZus{}command}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{loaddata}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{initial\PYGZus{}data.json}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{verbosity}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{)}  \PYG{c+c1}{\PYGZsh{} Load fixtures}
        \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{user} \PYG{o}{=} \PYG{n}{User}\PYG{o}{.}\PYG{n}{objects}\PYG{o}{.}\PYG{n}{create\PYGZus{}user}\PYG{p}{(}\PYG{n}{pk}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{username}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{testuser}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{password}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{12345}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{client} \PYG{o}{=} \PYG{n}{Client}\PYG{p}{(}\PYG{p}{)}

    \PYG{k}{def} \PYG{n+nf}{test\PYGZus{}get\PYGZus{}all\PYGZus{}animals}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{)}\PYG{p}{:}
        \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{} try to retrieve all animals \PYGZdq{}\PYGZdq{}\PYGZdq{}}
        \PYG{n}{response} \PYG{o}{=} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{client}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/animals/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{assertEqual}\PYG{p}{(}\PYG{n}{response}\PYG{o}{.}\PYG{n}{status\PYGZus{}code}\PYG{p}{,} \PYG{l+m+mi}{302}\PYG{p}{)}
        \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{client}\PYG{o}{.}\PYG{n}{login}\PYG{p}{(}\PYG{n}{username}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{testuser}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{password}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{12345}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{response} \PYG{o}{=} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{client}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/animals/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{assertEqual}\PYG{p}{(}\PYG{n}{response}\PYG{o}{.}\PYG{n}{status\PYGZus{}code}\PYG{p}{,} \PYG{l+m+mi}{200}\PYG{p}{)}

    \PYG{k}{def} \PYG{n+nf}{test\PYGZus{}get\PYGZus{}one\PYGZus{}animal}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{)}\PYG{p}{:}
        \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{} try to retrieve individual animals \PYGZdq{}\PYGZdq{}\PYGZdq{}}
        \PYG{n}{response} \PYG{o}{=} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{client}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/animals/1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{assertEqual}\PYG{p}{(}\PYG{n}{response}\PYG{o}{.}\PYG{n}{status\PYGZus{}code}\PYG{p}{,} \PYG{l+m+mi}{302}\PYG{p}{)}
        \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{client}\PYG{o}{.}\PYG{n}{login}\PYG{p}{(}\PYG{n}{username}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{testuser}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{password}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{12345}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{response} \PYG{o}{=} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{client}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/animals/1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{assertEqual}\PYG{p}{(}\PYG{n}{response}\PYG{o}{.}\PYG{n}{status\PYGZus{}code}\PYG{p}{,} \PYG{l+m+mi}{200}\PYG{p}{)}

    \PYG{k}{def} \PYG{n+nf}{test\PYGZus{}claim\PYGZus{}one\PYGZus{}animal}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{)}\PYG{p}{:}
        \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{} try to claim individual animals \PYGZdq{}\PYGZdq{}\PYGZdq{}}
        \PYG{n}{response} \PYG{o}{=} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{client}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/animals/claim/1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{assertEqual}\PYG{p}{(}\PYG{n}{response}\PYG{o}{.}\PYG{n}{status\PYGZus{}code}\PYG{p}{,} \PYG{l+m+mi}{302}\PYG{p}{)}
        \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{client}\PYG{o}{.}\PYG{n}{login}\PYG{p}{(}\PYG{n}{username}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{testuser}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{password}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{12345}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{response} \PYG{o}{=} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{client}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/animals/claim/1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{assertEqual}\PYG{p}{(}\PYG{n}{response}\PYG{o}{.}\PYG{n}{status\PYGZus{}code}\PYG{p}{,} \PYG{l+m+mi}{200}\PYG{p}{)}
\end{sphinxVerbatim}


\subsection{Upgrading django}
\label{\detokenize{index:upgrading-django}}
To upgrade django or any other python library for anishare, go into the anishare directory, and
activate its virtualenv:

\fvset{hllines={, ,}}%
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{cd} \PYG{n}{anishare}
\PYG{n}{source} \PYG{n+nb}{bin}\PYG{o}{/}\PYG{n}{activate}
\end{sphinxVerbatim}

Next, install/upgrade whatever library (here: django to the latest version):

\fvset{hllines={, ,}}%
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{pip} \PYG{n}{install} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{upgrade} \PYG{n}{django}
\end{sphinxVerbatim}

\begin{sphinxadmonition}{note}{Note:}
It’s best to test the latest version in a local/development environment first!
\end{sphinxadmonition}


\subsection{Upgrading python}
\label{\detokenize{index:upgrading-python}}
When upgrading the python version of the host operating system, it might be necessary to also
upgrade the python in the virtualenv. Otherwise an error like the following might occur:
\begin{quote}

\sphinxcode{\sphinxupquote{python: error while loading shared libraries: libpython3.4m.so.1.0: cannot open shared object file: No such file or directory}}
\end{quote}

In that case, go into the anishare directory, and delete the following directories:
\begin{itemize}
\item {} 
bin

\item {} 
include

\item {} 
lib

\item {} 
lib64

\end{itemize}

Afterwards, create a new virtualenv and install the required libraries like so:

\fvset{hllines={, ,}}%
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{virtualenv} \PYG{o}{\PYGZhy{}}\PYG{n}{p} \PYG{n}{python3} \PYG{o}{.}
\PYG{n}{source} \PYG{n+nb}{bin}\PYG{o}{/}\PYG{n}{activate}
\PYG{n}{pip} \PYG{n}{install} \PYG{o}{\PYGZhy{}}\PYG{n}{r} \PYG{n}{requirements}\PYG{o}{.}\PYG{n}{txt}
\end{sphinxVerbatim}


\chapter{API documentation}
\label{\detokenize{index:api-documentation}}

\section{Admin}
\label{\detokenize{index:module-animals.admin}}\label{\detokenize{index:admin}}\index{animals.admin (module)}
Admin module
\index{AnimalAdmin (class in animals.admin)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.admin.AnimalAdmin}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{animals.admin.}}\sphinxbfcode{\sphinxupquote{AnimalAdmin}}}{\emph{model}, \emph{admin\_site}}{}
ModelAdmin for Animal model
\index{age() (animals.admin.AnimalAdmin method)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.admin.AnimalAdmin.age}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{age}}}{\emph{obj}}{}
Show the age in the admin as ‘Age (w)’ instead of ‘age’

\end{fulllineitems}

\index{form (animals.admin.AnimalAdmin attribute)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.admin.AnimalAdmin.form}}\pysigline{\sphinxbfcode{\sphinxupquote{form}}}
alias of \sphinxcode{\sphinxupquote{AnimalForm}}

\end{fulllineitems}

\index{save\_model() (animals.admin.AnimalAdmin method)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.admin.AnimalAdmin.save_model}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{save\_model}}}{\emph{request}, \emph{obj}, \emph{form}, \emph{change}}{}
Given a model instance save it to the database.

\end{fulllineitems}


\end{fulllineitems}

\index{AnimalForm (class in animals.admin)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.admin.AnimalForm}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{animals.admin.}}\sphinxbfcode{\sphinxupquote{AnimalForm}}}{\emph{data=None}, \emph{files=None}, \emph{auto\_id='id\_\%s'}, \emph{prefix=None}, \emph{initial=None}, \emph{error\_class=\textless{}class 'django.forms.utils.ErrorList'\textgreater{}}, \emph{label\_suffix=None}, \emph{empty\_permitted=False}, \emph{instance=None}, \emph{use\_required\_attribute=None}}{}
Form for animal editing in admin
\index{clean() (animals.admin.AnimalForm method)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.admin.AnimalForm.clean}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{clean}}}{}{}
Hook for doing any extra form-wide cleaning after Field.clean() has been
called on every field. Any ValidationError raised by this method will
not be associated with a particular field; it will have a special-case
association with the field named ‘\_\_all\_\_’.

\end{fulllineitems}


\end{fulllineitems}

\index{LabAdmin (class in animals.admin)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.admin.LabAdmin}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{animals.admin.}}\sphinxbfcode{\sphinxupquote{LabAdmin}}}{\emph{model}, \emph{admin\_site}}{}
ModelAdmin for Lab model

\end{fulllineitems}

\index{LocationAdmin (class in animals.admin)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.admin.LocationAdmin}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{animals.admin.}}\sphinxbfcode{\sphinxupquote{LocationAdmin}}}{\emph{model}, \emph{admin\_site}}{}
ModelAdmin for Location model

\end{fulllineitems}

\index{OrganAdmin (class in animals.admin)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.admin.OrganAdmin}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{animals.admin.}}\sphinxbfcode{\sphinxupquote{OrganAdmin}}}{\emph{model}, \emph{admin\_site}}{}
ModelAdmin for Organ model
\index{age() (animals.admin.OrganAdmin method)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.admin.OrganAdmin.age}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{age}}}{\emph{obj}}{}
Show the age in the admin as ‘Age (w)’ instead of ‘age’

\end{fulllineitems}

\index{save\_model() (animals.admin.OrganAdmin method)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.admin.OrganAdmin.save_model}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{save\_model}}}{\emph{request}, \emph{obj}, \emph{form}, \emph{change}}{}
Given a model instance save it to the database.

\end{fulllineitems}


\end{fulllineitems}

\index{PersonAdmin (class in animals.admin)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.admin.PersonAdmin}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{animals.admin.}}\sphinxbfcode{\sphinxupquote{PersonAdmin}}}{\emph{model}, \emph{admin\_site}}{}
ModelAdmin for Person model

\end{fulllineitems}

\index{clear\_claim() (in module animals.admin)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.admin.clear_claim}}\pysiglinewithargsret{\sphinxcode{\sphinxupquote{animals.admin.}}\sphinxbfcode{\sphinxupquote{clear\_claim}}}{\emph{modeladmin}, \emph{request}, \emph{queryset}}{}
Convenience Function to delete a claim from several selected animals

\end{fulllineitems}


\fvset{hllines={, ,}}%
\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{Admin module}
\PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{k+kn}{from} \PYG{n+nn}{datetime} \PYG{k+kn}{import} \PYG{n}{datetime}\PYG{p}{,} \PYG{n}{timedelta}
\PYG{k+kn}{from} \PYG{n+nn}{django.contrib} \PYG{k+kn}{import} \PYG{n}{admin}
\PYG{k+kn}{from} \PYG{n+nn}{django} \PYG{k+kn}{import} \PYG{n}{forms}
\PYG{k+kn}{from} \PYG{n+nn}{django.conf} \PYG{k+kn}{import} \PYG{n}{settings}
\PYG{k+kn}{from} \PYG{n+nn}{.models} \PYG{k+kn}{import} \PYG{n}{Animal}\PYG{p}{,} \PYG{n}{Person}\PYG{p}{,} \PYG{n}{Lab}\PYG{p}{,} \PYG{n}{Location}\PYG{p}{,} \PYG{n}{Organ}
\PYG{k+kn}{from} \PYG{n+nn}{rangefilter.filter} \PYG{k+kn}{import} \PYG{n}{DateRangeFilter}\PYG{p}{,} \PYG{n}{DateTimeRangeFilter}


\PYG{n}{admin}\PYG{o}{.}\PYG{n}{site}\PYG{o}{.}\PYG{n}{site\PYGZus{}header} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{AniShare admin interface}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{admin}\PYG{o}{.}\PYG{n}{site}\PYG{o}{.}\PYG{n}{site\PYGZus{}title} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{AniShare}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{admin}\PYG{o}{.}\PYG{n}{site}\PYG{o}{.}\PYG{n}{index\PYGZus{}title} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Welcome to AniShare}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{k}{class} \PYG{n+nc}{AnimalForm}\PYG{p}{(}\PYG{n}{forms}\PYG{o}{.}\PYG{n}{ModelForm}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    Form for animal editing in admin}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{k}{class} \PYG{n+nc}{Meta}\PYG{p}{:}
        \PYG{n}{model} \PYG{o}{=} \PYG{n}{Animal}
        \PYG{n}{fields} \PYG{o}{=} \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{amount}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{animal\PYGZus{}type}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{day\PYGZus{}of\PYGZus{}birth}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                  \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{available\PYGZus{}from}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{available\PYGZus{}to}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sex}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{database\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                  \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lab\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{line}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{location}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{responsible\PYGZus{}person}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                  \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{licence\PYGZus{}number}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{mutations}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{comment}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{new\PYGZus{}owner}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{)}

    \PYG{k}{def} \PYG{n+nf}{clean}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{available\PYGZus{}from} \PYG{o}{=} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{cleaned\PYGZus{}data}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{available\PYGZus{}from}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{available\PYGZus{}to} \PYG{o}{=} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{cleaned\PYGZus{}data}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{available\PYGZus{}to}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{n}{day\PYGZus{}of\PYGZus{}birth} \PYG{o}{=} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{cleaned\PYGZus{}data}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{day\PYGZus{}of\PYGZus{}birth}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}        self.author =  request.user}
        \PYG{k}{if} \PYG{n}{available\PYGZus{}from} \PYG{o}{\PYGZgt{}} \PYG{n}{available\PYGZus{}to}\PYG{p}{:}
            \PYG{k}{raise} \PYG{n}{forms}\PYG{o}{.}\PYG{n}{ValidationError}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Dates are incorrect}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
        \PYG{k}{if} \PYG{n}{day\PYGZus{}of\PYGZus{}birth} \PYG{o+ow}{and} \PYG{p}{(}
                \PYG{p}{(}\PYG{n}{datetime}\PYG{o}{.}\PYG{n}{now}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{date}\PYG{p}{(}\PYG{p}{)} \PYG{o}{\PYGZhy{}}  \PYG{n}{day\PYGZus{}of\PYGZus{}birth}\PYG{p}{)} \PYG{o}{\PYGZlt{}}\PYG{o}{=}
                \PYG{n}{timedelta}\PYG{p}{(}\PYG{n}{days}\PYG{o}{=}\PYG{n}{settings}\PYG{o}{.}\PYG{n}{MIN\PYGZus{}SHARE\PYGZus{}DURATION\PYGZus{}PUPS}\PYG{p}{)}\PYG{p}{)}\PYG{p}{:}
            \PYG{k}{if} \PYG{n}{available\PYGZus{}to} \PYG{o}{\PYGZhy{}} \PYG{n}{available\PYGZus{}from} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{timedelta}\PYG{p}{(}\PYG{n}{days}\PYG{o}{=}\PYG{n}{settings}\PYG{o}{.}\PYG{n}{MIN\PYGZus{}SHARE\PYGZus{}DURATION\PYGZus{}PUPS}\PYG{p}{)}\PYG{p}{:}
                \PYG{k}{raise} \PYG{n}{forms}\PYG{o}{.}\PYG{n}{ValidationError}\PYG{p}{(}
                    \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Minimum share duration for pups must be \PYGZob{}\PYGZcb{} days!}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}
                        \PYG{n}{settings}\PYG{o}{.}\PYG{n}{MIN\PYGZus{}SHARE\PYGZus{}DURATION\PYGZus{}PUPS}\PYG{p}{)}\PYG{p}{)}
        \PYG{k}{elif} \PYG{n}{available\PYGZus{}to} \PYG{o}{\PYGZhy{}} \PYG{n}{available\PYGZus{}from} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{timedelta}\PYG{p}{(}\PYG{n}{days}\PYG{o}{=}\PYG{n}{settings}\PYG{o}{.}\PYG{n}{MIN\PYGZus{}SHARE\PYGZus{}DURATION}\PYG{p}{)}\PYG{p}{:}
            \PYG{k}{raise} \PYG{n}{forms}\PYG{o}{.}\PYG{n}{ValidationError}\PYG{p}{(}
                \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Minimum share duration must be \PYGZob{}\PYGZcb{} days!}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{settings}\PYG{o}{.}\PYG{n}{MIN\PYGZus{}SHARE\PYGZus{}DURATION}\PYG{p}{)}\PYG{p}{)}
        \PYG{k}{return} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{cleaned\PYGZus{}data}

\PYG{n+nd}{@admin.register}\PYG{p}{(}\PYG{n}{Person}\PYG{p}{)}
\PYG{k}{class} \PYG{n+nc}{PersonAdmin}\PYG{p}{(}\PYG{n}{admin}\PYG{o}{.}\PYG{n}{ModelAdmin}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    ModelAdmin for Person model}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{n}{list\PYGZus{}display} \PYG{o}{=} \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{email}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{responsible\PYGZus{}for\PYGZus{}lab}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{search\PYGZus{}fields} \PYG{o}{=} \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{email}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{responsible\PYGZus{}for\PYGZus{}lab\PYGZus{}\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{ordering} \PYG{o}{=} \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{)}

\PYG{n+nd}{@admin.register}\PYG{p}{(}\PYG{n}{Location}\PYG{p}{)}
\PYG{k}{class} \PYG{n+nc}{LocationAdmin}\PYG{p}{(}\PYG{n}{admin}\PYG{o}{.}\PYG{n}{ModelAdmin}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    ModelAdmin for Location model}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{n}{list\PYGZus{}display} \PYG{o}{=} \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{p}{)}
    \PYG{n}{search\PYGZus{}fields} \PYG{o}{=} \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{p}{)}

\PYG{k}{def} \PYG{n+nf}{clear\PYGZus{}claim}\PYG{p}{(}\PYG{n}{modeladmin}\PYG{p}{,} \PYG{n}{request}\PYG{p}{,} \PYG{n}{queryset}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    Convenience Function to delete a claim from several selected animals}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{n}{queryset}\PYG{o}{.}\PYG{n}{update}\PYG{p}{(}\PYG{n}{new\PYGZus{}owner}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{clear\PYGZus{}claim}\PYG{o}{.}\PYG{n}{short\PYGZus{}description} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Clear }\PYG{l+s+s2}{\PYGZsq{}}\PYG{l+s+s2}{new\PYGZus{}owner}\PYG{l+s+s2}{\PYGZsq{}}\PYG{l+s+s2}{ from selected animals}\PYG{l+s+s2}{\PYGZdq{}}


\PYG{n+nd}{@admin.register}\PYG{p}{(}\PYG{n}{Animal}\PYG{p}{)}
\PYG{k}{class} \PYG{n+nc}{AnimalAdmin}\PYG{p}{(}\PYG{n}{admin}\PYG{o}{.}\PYG{n}{ModelAdmin}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    ModelAdmin for Animal model}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{n}{list\PYGZus{}display} \PYG{o}{=} \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{amount}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{entry\PYGZus{}date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{day\PYGZus{}of\PYGZus{}birth}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{age}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{available\PYGZus{}from}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{available\PYGZus{}to}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{line}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sex}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{location}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{licence\PYGZus{}number}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{responsible\PYGZus{}person}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{added\PYGZus{}by}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{new\PYGZus{}owner}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{list\PYGZus{}display\PYGZus{}links} \PYG{o}{=} \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{amount}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{entry\PYGZus{}date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{day\PYGZus{}of\PYGZus{}birth}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{age}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                          \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{available\PYGZus{}from}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{available\PYGZus{}to}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{line}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sex}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                          \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{location}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{licence\PYGZus{}number}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{responsible\PYGZus{}person}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                          \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{added\PYGZus{}by}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{new\PYGZus{}owner}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{search\PYGZus{}fields} \PYG{o}{=} \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{amount}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{database\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lab\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{day\PYGZus{}of\PYGZus{}birth}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                     \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{line}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sex}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{location\PYGZus{}\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{new\PYGZus{}owner}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{licence\PYGZus{}number}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                     \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{mutations}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{available\PYGZus{}from}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{available\PYGZus{}to}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{responsible\PYGZus{}person\PYGZus{}\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                     \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{responsible\PYGZus{}person\PYGZus{}\PYGZus{}email}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{added\PYGZus{}by\PYGZus{}\PYGZus{}email}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{autocomplete\PYGZus{}fields} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{responsible\PYGZus{}person}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
    \PYG{n}{list\PYGZus{}filter} \PYG{o}{=} \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{amount}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sex}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{responsible\PYGZus{}person\PYGZus{}\PYGZus{}responsible\PYGZus{}for\PYGZus{}lab}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                   \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{day\PYGZus{}of\PYGZus{}birth}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{DateRangeFilter}\PYG{p}{)}\PYG{p}{,}
                   \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{location}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{licence\PYGZus{}number}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{new\PYGZus{}owner}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{added\PYGZus{}by}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{radio\PYGZus{}fields} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sex}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{n}{admin}\PYG{o}{.}\PYG{n}{HORIZONTAL}\PYG{p}{\PYGZcb{}}
    \PYG{n}{readonly\PYGZus{}fields} \PYG{o}{=} \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{creation\PYGZus{}date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{modification\PYGZus{}date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{form} \PYG{o}{=} \PYG{n}{AnimalForm}
    \PYG{n}{actions} \PYG{o}{=} \PYG{p}{[}\PYG{n}{clear\PYGZus{}claim}\PYG{p}{,}\PYG{p}{]}
    \PYG{k}{def} \PYG{n+nf}{age}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{,} \PYG{n}{obj}\PYG{p}{)}\PYG{p}{:}
        \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}Show the age in the admin as \PYGZsq{}Age (w)\PYGZsq{} instead of \PYGZsq{}age\PYGZsq{}\PYGZdq{}\PYGZdq{}\PYGZdq{}}
        \PYG{k}{return} \PYG{n}{obj}\PYG{o}{.}\PYG{n}{age}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{age}\PYG{o}{.}\PYG{n}{short\PYGZus{}description} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Age (w)}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{c+c1}{\PYGZsh{}    def formfield\PYGZus{}for\PYGZus{}foreignkey(self, db\PYGZus{}field, request, **kwargs):}
\PYG{c+c1}{\PYGZsh{}        if db\PYGZus{}field.name == \PYGZsq{}author\PYGZsq{}:}
\PYG{c+c1}{\PYGZsh{}            kwargs[\PYGZsq{}queryset\PYGZsq{}] = get\PYGZus{}user\PYGZus{}model().objects.filter(username=request.user.username)}
\PYG{c+c1}{\PYGZsh{}        return super(AnimalAdmin, self).formfield\PYGZus{}for\PYGZus{}foreignkey(db\PYGZus{}field, request, **kwargs)}
    \PYG{k}{def} \PYG{n+nf}{save\PYGZus{}model}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{,} \PYG{n}{request}\PYG{p}{,} \PYG{n}{obj}\PYG{p}{,} \PYG{n}{form}\PYG{p}{,} \PYG{n}{change}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{if} \PYG{o+ow}{not} \PYG{n}{obj}\PYG{o}{.}\PYG{n}{pk}\PYG{p}{:}
            \PYG{c+c1}{\PYGZsh{} Only set added\PYGZus{}by during the first save.}
            \PYG{n}{obj}\PYG{o}{.}\PYG{n}{added\PYGZus{}by} \PYG{o}{=} \PYG{n}{request}\PYG{o}{.}\PYG{n}{user}
        \PYG{n+nb}{super}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{save\PYGZus{}model}\PYG{p}{(}\PYG{n}{request}\PYG{p}{,} \PYG{n}{obj}\PYG{p}{,} \PYG{n}{form}\PYG{p}{,} \PYG{n}{change}\PYG{p}{)}

\PYG{n+nd}{@admin.register}\PYG{p}{(}\PYG{n}{Organ}\PYG{p}{)}
\PYG{k}{class} \PYG{n+nc}{OrganAdmin}\PYG{p}{(}\PYG{n}{admin}\PYG{o}{.}\PYG{n}{ModelAdmin}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    ModelAdmin for Organ model}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{n}{list\PYGZus{}display} \PYG{o}{=} \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{amount}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{animal\PYGZus{}type}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{organ\PYGZus{}type}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{entry\PYGZus{}date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{day\PYGZus{}of\PYGZus{}birth}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{day\PYGZus{}of\PYGZus{}death}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{age}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{method\PYGZus{}of\PYGZus{}killing}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{killing\PYGZus{}person}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{line}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sex}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{location}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{licence\PYGZus{}number}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{responsible\PYGZus{}person}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{added\PYGZus{}by}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{list\PYGZus{}display\PYGZus{}links} \PYG{o}{=} \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{amount}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{animal\PYGZus{}type}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{organ\PYGZus{}type}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{entry\PYGZus{}date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{day\PYGZus{}of\PYGZus{}birth}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                          \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{day\PYGZus{}of\PYGZus{}death}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{age}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{method\PYGZus{}of\PYGZus{}killing}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{killing\PYGZus{}person}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{line}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                          \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sex}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{location}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{licence\PYGZus{}number}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{responsible\PYGZus{}person}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{added\PYGZus{}by}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{search\PYGZus{}fields} \PYG{o}{=} \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{amount}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{animal\PYGZus{}type}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{organ\PYGZus{}type}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{entry\PYGZus{}date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{day\PYGZus{}of\PYGZus{}birth}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                     \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{day\PYGZus{}of\PYGZus{}death}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{age}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{method\PYGZus{}of\PYGZus{}killing}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{killing\PYGZus{}person}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{line}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                     \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sex}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{location}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{licence\PYGZus{}number}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{responsible\PYGZus{}person}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{added\PYGZus{}by}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{autocomplete\PYGZus{}fields} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{responsible\PYGZus{}person}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
    \PYG{n}{list\PYGZus{}filter} \PYG{o}{=} \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{amount}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sex}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{responsible\PYGZus{}person\PYGZus{}\PYGZus{}responsible\PYGZus{}for\PYGZus{}lab}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                   \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{day\PYGZus{}of\PYGZus{}birth}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{DateRangeFilter}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{day\PYGZus{}of\PYGZus{}death}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{DateRangeFilter}\PYG{p}{)}\PYG{p}{,}
                   \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{location}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{licence\PYGZus{}number}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{added\PYGZus{}by}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{radio\PYGZus{}fields} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sex}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{n}{admin}\PYG{o}{.}\PYG{n}{HORIZONTAL}\PYG{p}{\PYGZcb{}}
    \PYG{n}{readonly\PYGZus{}fields} \PYG{o}{=} \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{added\PYGZus{}by}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{creation\PYGZus{}date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{modification\PYGZus{}date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}    form = OrganForm}
    \PYG{n}{actions} \PYG{o}{=} \PYG{p}{[}\PYG{n}{clear\PYGZus{}claim}\PYG{p}{,}\PYG{p}{]}

    \PYG{k}{def} \PYG{n+nf}{age}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{,} \PYG{n}{obj}\PYG{p}{)}\PYG{p}{:}
        \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}Show the age in the admin as \PYGZsq{}Age (w)\PYGZsq{} instead of \PYGZsq{}age\PYGZsq{}\PYGZdq{}\PYGZdq{}\PYGZdq{}}
        \PYG{k}{return} \PYG{n}{obj}\PYG{o}{.}\PYG{n}{age}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{age}\PYG{o}{.}\PYG{n}{short\PYGZus{}description} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Age (w)}\PYG{l+s+s1}{\PYGZsq{}}

    \PYG{k}{def} \PYG{n+nf}{save\PYGZus{}model}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{,} \PYG{n}{request}\PYG{p}{,} \PYG{n}{obj}\PYG{p}{,} \PYG{n}{form}\PYG{p}{,} \PYG{n}{change}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{if} \PYG{o+ow}{not} \PYG{n}{obj}\PYG{o}{.}\PYG{n}{pk}\PYG{p}{:}
            \PYG{c+c1}{\PYGZsh{} Only set added\PYGZus{}by during the first save.}
            \PYG{n}{obj}\PYG{o}{.}\PYG{n}{added\PYGZus{}by} \PYG{o}{=} \PYG{n}{request}\PYG{o}{.}\PYG{n}{user}
        \PYG{n+nb}{super}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{save\PYGZus{}model}\PYG{p}{(}\PYG{n}{request}\PYG{p}{,} \PYG{n}{obj}\PYG{p}{,} \PYG{n}{form}\PYG{p}{,} \PYG{n}{change}\PYG{p}{)}

\PYG{n+nd}{@admin.register}\PYG{p}{(}\PYG{n}{Lab}\PYG{p}{)}
\PYG{k}{class} \PYG{n+nc}{LabAdmin}\PYG{p}{(}\PYG{n}{admin}\PYG{o}{.}\PYG{n}{ModelAdmin}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    ModelAdmin for Lab model}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{n}{list\PYGZus{}display} \PYG{o}{=} \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{responsible\PYGZus{}person}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{search\PYGZus{}fields} \PYG{o}{=} \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{p}{)}
\end{sphinxVerbatim}


\section{Models}
\label{\detokenize{index:module-animals.models}}\label{\detokenize{index:models}}\index{animals.models (module)}
This file describes all the models in the database.
\index{Animal (class in animals.models)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.models.Animal}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{animals.models.}}\sphinxbfcode{\sphinxupquote{Animal}}}{\emph{*args}, \emph{**kwargs}}{}
Main model containing the animals.
\index{Animal.DoesNotExist}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.models.Animal.DoesNotExist}}\pysigline{\sphinxbfcode{\sphinxupquote{exception }}\sphinxbfcode{\sphinxupquote{DoesNotExist}}}
\end{fulllineitems}

\index{Animal.MultipleObjectsReturned}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.models.Animal.MultipleObjectsReturned}}\pysigline{\sphinxbfcode{\sphinxupquote{exception }}\sphinxbfcode{\sphinxupquote{MultipleObjectsReturned}}}
\end{fulllineitems}

\index{age() (animals.models.Animal method)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.models.Animal.age}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{age}}}{}{}
Return the age of the animal, calculated by the difference to either
the current date or the available\_to date

\end{fulllineitems}

\index{available() (animals.models.Animal method)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.models.Animal.available}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{available}}}{}{}
Returns True if the animal is still available

\end{fulllineitems}

\index{description() (animals.models.Animal method)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.models.Animal.description}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{description}}}{}{}
Return description of this model

\end{fulllineitems}

\index{get\_absolute\_url() (animals.models.Animal method)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.models.Animal.get_absolute_url}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{get\_absolute\_url}}}{}{}
Get absolute url for this model. Important to link from the admin.

\end{fulllineitems}


\end{fulllineitems}

\index{Lab (class in animals.models)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.models.Lab}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{animals.models.}}\sphinxbfcode{\sphinxupquote{Lab}}}{\emph{*args}, \emph{**kwargs}}{}
Labs are only defined by a name and are referenced by
Person(s) which are responsible (contact) person for this lab
\index{Lab.DoesNotExist}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.models.Lab.DoesNotExist}}\pysigline{\sphinxbfcode{\sphinxupquote{exception }}\sphinxbfcode{\sphinxupquote{DoesNotExist}}}
\end{fulllineitems}

\index{Lab.MultipleObjectsReturned}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.models.Lab.MultipleObjectsReturned}}\pysigline{\sphinxbfcode{\sphinxupquote{exception }}\sphinxbfcode{\sphinxupquote{MultipleObjectsReturned}}}
\end{fulllineitems}

\index{responsible\_person() (animals.models.Lab method)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.models.Lab.responsible_person}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{responsible\_person}}}{}{}
Retrieve only the person(s) which are responsible for this lab.

\end{fulllineitems}


\end{fulllineitems}

\index{Location (class in animals.models)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.models.Location}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{animals.models.}}\sphinxbfcode{\sphinxupquote{Location}}}{\emph{*args}, \emph{**kwargs}}{}
Location of animals. Eg. animal house, fish facilities etc.
\index{Location.DoesNotExist}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.models.Location.DoesNotExist}}\pysigline{\sphinxbfcode{\sphinxupquote{exception }}\sphinxbfcode{\sphinxupquote{DoesNotExist}}}
\end{fulllineitems}

\index{Location.MultipleObjectsReturned}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.models.Location.MultipleObjectsReturned}}\pysigline{\sphinxbfcode{\sphinxupquote{exception }}\sphinxbfcode{\sphinxupquote{MultipleObjectsReturned}}}
\end{fulllineitems}


\end{fulllineitems}

\index{Organ (class in animals.models)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.models.Organ}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{animals.models.}}\sphinxbfcode{\sphinxupquote{Organ}}}{\emph{*args}, \emph{**kwargs}}{}
Model containing the organs
\index{Organ.DoesNotExist}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.models.Organ.DoesNotExist}}\pysigline{\sphinxbfcode{\sphinxupquote{exception }}\sphinxbfcode{\sphinxupquote{DoesNotExist}}}
\end{fulllineitems}

\index{Organ.MultipleObjectsReturned}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.models.Organ.MultipleObjectsReturned}}\pysigline{\sphinxbfcode{\sphinxupquote{exception }}\sphinxbfcode{\sphinxupquote{MultipleObjectsReturned}}}
\end{fulllineitems}

\index{age() (animals.models.Organ method)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.models.Organ.age}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{age}}}{}{}
Return the age of the animal, at the time of death

\end{fulllineitems}

\index{available() (animals.models.Organ method)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.models.Organ.available}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{available}}}{}{}
Returns True if the animal is still available

\end{fulllineitems}

\index{description() (animals.models.Organ method)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.models.Organ.description}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{description}}}{}{}
Return description of this model

\end{fulllineitems}

\index{get\_absolute\_url() (animals.models.Organ method)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.models.Organ.get_absolute_url}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{get\_absolute\_url}}}{}{}
Get absolute url for this model. Important to link from the admin.

\end{fulllineitems}


\end{fulllineitems}

\index{Person (class in animals.models)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.models.Person}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{animals.models.}}\sphinxbfcode{\sphinxupquote{Person}}}{\emph{*args}, \emph{**kwargs}}{}
The responsible (contact) person for each lab.
This person gets an email when an animal is being claimed.
\index{Person.DoesNotExist}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.models.Person.DoesNotExist}}\pysigline{\sphinxbfcode{\sphinxupquote{exception }}\sphinxbfcode{\sphinxupquote{DoesNotExist}}}
\end{fulllineitems}

\index{Person.MultipleObjectsReturned}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.models.Person.MultipleObjectsReturned}}\pysigline{\sphinxbfcode{\sphinxupquote{exception }}\sphinxbfcode{\sphinxupquote{MultipleObjectsReturned}}}
\end{fulllineitems}


\end{fulllineitems}


\fvset{hllines={, ,}}%
\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{This file describes all the models in the database.}
\PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{k+kn}{from} \PYG{n+nn}{datetime} \PYG{k+kn}{import} \PYG{n}{datetime}
\PYG{k+kn}{from} \PYG{n+nn}{django.urls} \PYG{k+kn}{import} \PYG{n}{reverse}
\PYG{k+kn}{from} \PYG{n+nn}{django.db} \PYG{k+kn}{import} \PYG{n}{models}
\PYG{k+kn}{from} \PYG{n+nn}{django.contrib.auth.models} \PYG{k+kn}{import} \PYG{n}{User}

\PYG{k}{class} \PYG{n+nc}{Lab}\PYG{p}{(}\PYG{n}{models}\PYG{o}{.}\PYG{n}{Model}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    Labs are only defined by a name and are referenced by}
\PYG{l+s+sd}{    Person(s) which are responsible (contact) person for this lab}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{n}{name} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{CharField}\PYG{p}{(}\PYG{n}{max\PYGZus{}length}\PYG{o}{=}\PYG{l+m+mi}{200}\PYG{p}{)}
    \PYG{k}{def} \PYG{n+nf+fm}{\PYGZus{}\PYGZus{}str\PYGZus{}\PYGZus{}}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{return} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{name} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ Lab}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{k}{def} \PYG{n+nf}{responsible\PYGZus{}person}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{)}\PYG{p}{:}
        \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{        Retrieve only the person(s) which are responsible for this lab.}
\PYG{l+s+sd}{        \PYGZdq{}\PYGZdq{}\PYGZdq{}}
        \PYG{n}{persons} \PYG{o}{=} \PYG{n}{Person}\PYG{o}{.}\PYG{n}{objects}\PYG{o}{.}\PYG{n}{filter}\PYG{p}{(}\PYG{n}{responsible\PYGZus{}for\PYGZus{}lab}\PYG{o}{=}\PYG{n+nb+bp}{self}\PYG{p}{)}
        \PYG{k}{return} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{, }\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{i}\PYG{o}{.}\PYG{n}{name} \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n}{persons}\PYG{p}{)}

\PYG{k}{class} \PYG{n+nc}{Person}\PYG{p}{(}\PYG{n}{models}\PYG{o}{.}\PYG{n}{Model}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    The responsible (contact) person for each lab.}
\PYG{l+s+sd}{    This person gets an email when an animal is being claimed.}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{n}{name} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{CharField}\PYG{p}{(}\PYG{n}{max\PYGZus{}length}\PYG{o}{=}\PYG{l+m+mi}{200}\PYG{p}{)}
    \PYG{n}{email} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{EmailField}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{responsible\PYGZus{}for\PYGZus{}lab} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{ForeignKey}\PYG{p}{(}\PYG{n}{Lab}\PYG{p}{,} \PYG{n}{on\PYGZus{}delete}\PYG{o}{=}\PYG{n}{models}\PYG{o}{.}\PYG{n}{CASCADE}\PYG{p}{,} \PYG{n}{default}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{)}
    \PYG{k}{def} \PYG{n+nf+fm}{\PYGZus{}\PYGZus{}str\PYGZus{}\PYGZus{}}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{return} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{name} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ (}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{responsible\PYGZus{}for\PYGZus{}lab}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{)}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{k}{class} \PYG{n+nc}{Location}\PYG{p}{(}\PYG{n}{models}\PYG{o}{.}\PYG{n}{Model}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    Location of animals. Eg. animal house, fish facilities etc.}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{n}{name} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{CharField}\PYG{p}{(}\PYG{n}{max\PYGZus{}length}\PYG{o}{=}\PYG{l+m+mi}{200}\PYG{p}{)}
    \PYG{k}{def} \PYG{n+nf+fm}{\PYGZus{}\PYGZus{}str\PYGZus{}\PYGZus{}}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{return} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{name}

\PYG{k}{class} \PYG{n+nc}{Animal}\PYG{p}{(}\PYG{n}{models}\PYG{o}{.}\PYG{n}{Model}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    Main model containing the animals.}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{n}{amount} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{PositiveIntegerField}\PYG{p}{(}\PYG{n}{default}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{,}
                                         \PYG{n}{help\PYGZus{}text}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{How many animals? (eg. fish in tank)}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{n}{animal\PYGZus{}type} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{CharField}\PYG{p}{(}\PYG{n}{max\PYGZus{}length}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{,} \PYG{n}{choices}\PYG{o}{=}\PYG{p}{(}
        \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{fish}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{fish}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
        \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{mouse}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{mouse}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
    \PYG{p}{)}\PYG{p}{,}
                                   \PYG{n}{default}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{mouse}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{database\PYGZus{}id} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{CharField}\PYG{p}{(}\PYG{n}{max\PYGZus{}length}\PYG{o}{=}\PYG{l+m+mi}{200}\PYG{p}{,} \PYG{n}{help\PYGZus{}text}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ID of animal in eg. PYRAT}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{n}{lab\PYGZus{}id} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{CharField}\PYG{p}{(}\PYG{n}{max\PYGZus{}length}\PYG{o}{=}\PYG{l+m+mi}{200}\PYG{p}{,} \PYG{n}{help\PYGZus{}text}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ID of lab in eg. PYRAT}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{n}{creation\PYGZus{}date} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{DateTimeField}\PYG{p}{(}\PYG{n}{null}\PYG{o}{=}\PYG{n+nb+bp}{False}\PYG{p}{,} \PYG{n}{auto\PYGZus{}now\PYGZus{}add}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}
    \PYG{n}{modification\PYGZus{}date} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{DateTimeField}\PYG{p}{(}\PYG{n}{null}\PYG{o}{=}\PYG{n+nb+bp}{False}\PYG{p}{,} \PYG{n}{auto\PYGZus{}now}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}
    \PYG{n}{entry\PYGZus{}date} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{DateField}\PYG{p}{(}\PYG{n}{null}\PYG{o}{=}\PYG{n+nb+bp}{False}\PYG{p}{,} \PYG{n}{auto\PYGZus{}now\PYGZus{}add}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}
    \PYG{n}{day\PYGZus{}of\PYGZus{}birth} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{DateField}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{line} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{CharField}\PYG{p}{(}\PYG{n}{max\PYGZus{}length}\PYG{o}{=}\PYG{l+m+mi}{200}\PYG{p}{,} \PYG{n}{help\PYGZus{}text}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{genetic trait of animal}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{n}{sex} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{CharField}\PYG{p}{(}\PYG{n}{max\PYGZus{}length}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{choices}\PYG{o}{=}\PYG{p}{(}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{m}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{male}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{female}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{u}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{unknown}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
                           \PYG{n}{help\PYGZus{}text}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Select }\PYG{l+s+s1}{\PYGZdq{}}\PYG{l+s+s1}{unknown}\PYG{l+s+s1}{\PYGZdq{}}\PYG{l+s+s1}{ if multiple animals.}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{location} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{ForeignKey}\PYG{p}{(}\PYG{n}{Location}\PYG{p}{,} \PYG{n}{on\PYGZus{}delete}\PYG{o}{=}\PYG{n}{models}\PYG{o}{.}\PYG{n}{CASCADE}\PYG{p}{,}
                                 \PYG{n}{help\PYGZus{}text}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Where is the animal housed?}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{mutations} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{TextField}\PYG{p}{(}\PYG{n}{blank}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{,} \PYG{n}{null}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{,}
                                 \PYG{n}{help\PYGZus{}text}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Describe the mutations of this line in as much detail as possible}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{n}{licence\PYGZus{}number} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{CharField}\PYG{p}{(}\PYG{n}{max\PYGZus{}length}\PYG{o}{=}\PYG{l+m+mi}{200}\PYG{p}{)}
    \PYG{n}{responsible\PYGZus{}person} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{ForeignKey}\PYG{p}{(}\PYG{n}{Person}\PYG{p}{,} \PYG{n}{on\PYGZus{}delete}\PYG{o}{=}\PYG{n}{models}\PYG{o}{.}\PYG{n}{CASCADE}\PYG{p}{,} \PYG{n}{default}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{,}
                                           \PYG{n}{help\PYGZus{}text}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Person who is responsible in the lab for dealing with the animals}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{available\PYGZus{}from} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{DateField}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{available\PYGZus{}to} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{DateField}\PYG{p}{(}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} default=datetime.today() + timedelta(days=15))}
    \PYG{n}{comment} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{TextField}\PYG{p}{(}\PYG{n}{blank}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{,} \PYG{n}{null}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{,}
                               \PYG{n}{help\PYGZus{}text}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Comments, such as individual organs to be offered}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{new\PYGZus{}owner} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{CharField}\PYG{p}{(}\PYG{n}{max\PYGZus{}length}\PYG{o}{=}\PYG{l+m+mi}{200}\PYG{p}{,} \PYG{n}{blank}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{,}
                                 \PYG{n}{help\PYGZus{}text}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Person claiming this animal for themselves}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} turn into foreignkey to auth\PYGZus{}users?}
    \PYG{n}{added\PYGZus{}by} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{ForeignKey}\PYG{p}{(}\PYG{n}{User}\PYG{p}{,} \PYG{n}{unique}\PYG{o}{=}\PYG{n+nb+bp}{False}\PYG{p}{,} \PYG{n}{on\PYGZus{}delete}\PYG{o}{=}\PYG{n}{models}\PYG{o}{.}\PYG{n}{CASCADE}\PYG{p}{,} \PYG{n}{default}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}

    \PYG{k}{def} \PYG{n+nf}{age}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{)}\PYG{p}{:}
        \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{        Return the age of the animal, calculated by the difference to either}
\PYG{l+s+sd}{        the current date or the available\PYGZus{}to date}
\PYG{l+s+sd}{        \PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{c+c1}{\PYGZsh{}        return int((self.entry\PYGZus{}date \PYGZhy{} self.day\PYGZus{}of\PYGZus{}birth).days / 7)}
        \PYG{n}{now} \PYG{o}{=} \PYG{n}{datetime}\PYG{o}{.}\PYG{n}{today}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{date}\PYG{p}{(}\PYG{p}{)}
        \PYG{k}{if} \PYG{n}{now} \PYG{o}{\PYGZlt{}} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{available\PYGZus{}to}\PYG{p}{:}
            \PYG{k}{return} \PYG{n+nb}{int}\PYG{p}{(}\PYG{p}{(}\PYG{n}{now} \PYG{o}{\PYGZhy{}} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{day\PYGZus{}of\PYGZus{}birth}\PYG{p}{)}\PYG{o}{.}\PYG{n}{days} \PYG{o}{/} \PYG{l+m+mi}{7}\PYG{p}{)}
        \PYG{k}{return} \PYG{n+nb}{int}\PYG{p}{(}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{available\PYGZus{}to} \PYG{o}{\PYGZhy{}} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{day\PYGZus{}of\PYGZus{}birth}\PYG{p}{)}\PYG{o}{.}\PYG{n}{days} \PYG{o}{/} \PYG{l+m+mi}{7}\PYG{p}{)}

    \PYG{k}{def} \PYG{n+nf}{available}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{)}\PYG{p}{:}
        \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{        Returns True if the animal is still available}
\PYG{l+s+sd}{        \PYGZdq{}\PYGZdq{}\PYGZdq{}}
        \PYG{n}{today} \PYG{o}{=} \PYG{n}{datetime}\PYG{o}{.}\PYG{n}{now}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{date}\PYG{p}{(}\PYG{p}{)}
        \PYG{k}{return} \PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{available\PYGZus{}from} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{today}\PYG{p}{)} \PYG{o+ow}{and} \PYG{p}{(}\PYG{n}{today} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{available\PYGZus{}to}\PYG{p}{)}

    \PYG{k}{def} \PYG{n+nf}{get\PYGZus{}absolute\PYGZus{}url}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{)}\PYG{p}{:}
        \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{        Get absolute url for this model. Important to link from the admin.}
\PYG{l+s+sd}{        \PYGZdq{}\PYGZdq{}\PYGZdq{}}
        \PYG{k}{return} \PYG{n}{reverse}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{animals:claim}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{kwargs}\PYG{o}{=}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{primary\PYGZus{}key}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{pk}\PYG{p}{\PYGZcb{}}\PYG{p}{)}

    \PYG{k}{def} \PYG{n+nf+fm}{\PYGZus{}\PYGZus{}str\PYGZus{}\PYGZus{}}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{return} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}\PYGZcb{} \PYGZob{}\PYGZcb{} \PYGZob{}\PYGZcb{}, \PYGZob{}\PYGZcb{} id:\PYGZob{}\PYGZcb{} [\PYGZob{}\PYGZcb{}]}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}
            \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{amount}\PYG{p}{,} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{get\PYGZus{}sex\PYGZus{}display}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{animal\PYGZus{}type}\PYG{p}{,} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{line}\PYG{p}{,} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{pk}\PYG{p}{,} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{day\PYGZus{}of\PYGZus{}birth}\PYG{p}{)}

    \PYG{k}{def} \PYG{n+nf}{description}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{)}\PYG{p}{:}
        \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{        Return description of this model}
\PYG{l+s+sd}{        \PYGZdq{}\PYGZdq{}\PYGZdq{}}
        \PYG{k}{return} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{id:\PYGZob{}\PYGZcb{}, lab\PYGZus{}id:\PYGZob{}\PYGZcb{}, available:\PYGZob{}\PYGZcb{}\PYGZhy{}\PYGZob{}\PYGZcb{}, location:\PYGZob{}\PYGZcb{}, mutations:\PYGZob{}\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}
            \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{database\PYGZus{}id}\PYG{p}{,} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{lab\PYGZus{}id}\PYG{p}{,} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{available\PYGZus{}from}\PYG{p}{,}
            \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{available\PYGZus{}to}\PYG{p}{,} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{location}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{mutations}\PYG{p}{)}\PYG{p}{)}



\PYG{k}{class} \PYG{n+nc}{Organ}\PYG{p}{(}\PYG{n}{models}\PYG{o}{.}\PYG{n}{Model}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    Model containing the organs}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{n}{amount} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{PositiveIntegerField}\PYG{p}{(}\PYG{n}{default}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{,}
                                         \PYG{n}{help\PYGZus{}text}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{How many organs?}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{n}{animal\PYGZus{}type} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{CharField}\PYG{p}{(}\PYG{n}{max\PYGZus{}length}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{,} \PYG{n}{choices}\PYG{o}{=}\PYG{p}{(}
        \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{fish}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{fish}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
        \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{mouse}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{mouse}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
        \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{unknown}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{unknown}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
        \PYG{p}{)}\PYG{p}{,}
                                   \PYG{n}{default}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{mouse}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{sex} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{CharField}\PYG{p}{(}\PYG{n}{max\PYGZus{}length}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{choices}\PYG{o}{=}\PYG{p}{(}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{m}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{male}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{female}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,} \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{u}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{unknown}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}
                           \PYG{n}{help\PYGZus{}text}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Select }\PYG{l+s+s1}{\PYGZdq{}}\PYG{l+s+s1}{unknown}\PYG{l+s+s1}{\PYGZdq{}}\PYG{l+s+s1}{ if multiple animals.}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{organ\PYGZus{}type} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{CharField}\PYG{p}{(}\PYG{n}{max\PYGZus{}length}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{,} \PYG{n}{choices}\PYG{o}{=}\PYG{p}{(}
        \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{bladder}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{bladder}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
        \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{bone marrow}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{bone marrow}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
        \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{brain}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{brain}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
        \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{genitals}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{genitals}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
        \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{heart}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{heart}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
        \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{intestine}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{intestine}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
        \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{kidney}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{kidney}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
        \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{liver}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{liver}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
        \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lungs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lungs}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
        \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{spleen}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{spleen}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
        \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{stomach}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{stomach}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
        \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{other}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{other}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
        \PYG{p}{)}\PYG{p}{,}
                                 \PYG{p}{)}
    \PYG{n}{day\PYGZus{}of\PYGZus{}birth} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{DateField}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{day\PYGZus{}of\PYGZus{}death} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{DateField}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{method\PYGZus{}of\PYGZus{}killing} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{CharField}\PYG{p}{(}\PYG{n}{max\PYGZus{}length}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{,} \PYG{n}{choices}\PYG{o}{=}\PYG{p}{(}
        \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{CO2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{CO2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
        \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{cervicale dislocation}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{cervicale dislocation}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
        \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{decapitation}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{decapitation}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
        \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{blood withdrawl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{blood withdrawl}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
        \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{finale heart punction}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{finale heart punction}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
        \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{overdose anaesthetics}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{overdose anaesthetic}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
        \PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{other}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{other}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
        \PYG{p}{)}\PYG{p}{,}\PYG{p}{)}
    \PYG{n}{killing\PYGZus{}person} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{EmailField}\PYG{p}{(}\PYG{n}{help\PYGZus{}text}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Email address of the person who is responsible for killing the animal}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{database\PYGZus{}id} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{CharField}\PYG{p}{(}\PYG{n}{max\PYGZus{}length}\PYG{o}{=}\PYG{l+m+mi}{200}\PYG{p}{,} \PYG{n}{help\PYGZus{}text}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ID of animal in eg. PYRAT}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{n}{lab\PYGZus{}id} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{CharField}\PYG{p}{(}\PYG{n}{max\PYGZus{}length}\PYG{o}{=}\PYG{l+m+mi}{200}\PYG{p}{,} \PYG{n}{help\PYGZus{}text}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{ID of lab in eg. PYRAT}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{n}{entry\PYGZus{}date} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{DateField}\PYG{p}{(}\PYG{n}{null}\PYG{o}{=}\PYG{n+nb+bp}{False}\PYG{p}{,} \PYG{n}{auto\PYGZus{}now\PYGZus{}add}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}
    \PYG{n}{line} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{CharField}\PYG{p}{(}\PYG{n}{max\PYGZus{}length}\PYG{o}{=}\PYG{l+m+mi}{200}\PYG{p}{,} \PYG{n}{help\PYGZus{}text}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{genetic trait of animal}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{n}{location} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{ForeignKey}\PYG{p}{(}\PYG{n}{Location}\PYG{p}{,} \PYG{n}{on\PYGZus{}delete}\PYG{o}{=}\PYG{n}{models}\PYG{o}{.}\PYG{n}{CASCADE}\PYG{p}{,} \PYG{n}{help\PYGZus{}text}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Where is the animal housed?}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{licence\PYGZus{}number} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{CharField}\PYG{p}{(}\PYG{n}{max\PYGZus{}length}\PYG{o}{=}\PYG{l+m+mi}{200}\PYG{p}{)}
    \PYG{n}{responsible\PYGZus{}person} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{ForeignKey}\PYG{p}{(}\PYG{n}{Person}\PYG{p}{,} \PYG{n}{on\PYGZus{}delete}\PYG{o}{=}\PYG{n}{models}\PYG{o}{.}\PYG{n}{CASCADE}\PYG{p}{,} \PYG{n}{default}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{,}
                                           \PYG{n}{help\PYGZus{}text}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Person who is responsible in the lab for dealing with the animals}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{mutations} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{TextField}\PYG{p}{(}\PYG{n}{blank}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{,} \PYG{n}{null}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{,} \PYG{n}{help\PYGZus{}text}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Describe the mutations of this line in as much detail as possible}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{n}{comment} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{TextField}\PYG{p}{(}\PYG{n}{blank}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{,} \PYG{n}{null}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{,}
                               \PYG{n}{help\PYGZus{}text}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Comments, such as individual organs to be offered}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}    new\PYGZus{}owner = models.CharField(max\PYGZus{}length=200, blank=True,}
\PYG{c+c1}{\PYGZsh{}                                 help\PYGZus{}text=\PYGZsq{}Person claiming this animal for themselves\PYGZsq{}) \PYGZsh{} turn into foreignkey to auth\PYGZus{}users?}
    \PYG{n}{creation\PYGZus{}date} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{DateTimeField}\PYG{p}{(}\PYG{n}{null}\PYG{o}{=}\PYG{n+nb+bp}{False}\PYG{p}{,} \PYG{n}{auto\PYGZus{}now\PYGZus{}add}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}
    \PYG{n}{modification\PYGZus{}date} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{DateTimeField}\PYG{p}{(}\PYG{n}{null}\PYG{o}{=}\PYG{n+nb+bp}{False}\PYG{p}{,} \PYG{n}{auto\PYGZus{}now}\PYG{o}{=}\PYG{n+nb+bp}{True}\PYG{p}{)}
    \PYG{n}{added\PYGZus{}by} \PYG{o}{=} \PYG{n}{models}\PYG{o}{.}\PYG{n}{ForeignKey}\PYG{p}{(}\PYG{n}{User}\PYG{p}{,} \PYG{n}{unique}\PYG{o}{=}\PYG{n+nb+bp}{False}\PYG{p}{,} \PYG{n}{on\PYGZus{}delete}\PYG{o}{=}\PYG{n}{models}\PYG{o}{.}\PYG{n}{CASCADE}\PYG{p}{,} \PYG{n}{default}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}

    \PYG{k}{def} \PYG{n+nf}{age}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{)}\PYG{p}{:}
        \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{        Return the age of the animal, at the time of death}
\PYG{l+s+sd}{        \PYGZdq{}\PYGZdq{}\PYGZdq{}}
        \PYG{k}{return} \PYG{n+nb}{int}\PYG{p}{(}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{day\PYGZus{}of\PYGZus{}death} \PYG{o}{\PYGZhy{}} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{day\PYGZus{}of\PYGZus{}birth}\PYG{p}{)}\PYG{o}{.}\PYG{n}{days} \PYG{o}{/} \PYG{l+m+mi}{7}\PYG{p}{)}

    \PYG{k}{def} \PYG{n+nf}{available}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{)}\PYG{p}{:}
        \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{        Returns True if the animal is still available}
\PYG{l+s+sd}{        \PYGZdq{}\PYGZdq{}\PYGZdq{}}
        \PYG{n}{today} \PYG{o}{=} \PYG{n}{datetime}\PYG{o}{.}\PYG{n}{now}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{date}\PYG{p}{(}\PYG{p}{)}
        \PYG{k}{return} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{day\PYGZus{}of\PYGZus{}death} \PYG{o}{\PYGZgt{}}\PYG{o}{=} \PYG{n}{today}

    \PYG{k}{def} \PYG{n+nf}{get\PYGZus{}absolute\PYGZus{}url}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{)}\PYG{p}{:}
        \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{        Get absolute url for this model. Important to link from the admin.}
\PYG{l+s+sd}{        \PYGZdq{}\PYGZdq{}\PYGZdq{}}
        \PYG{k}{return} \PYG{n}{reverse}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{claim\PYGZus{}organ}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{kwargs}\PYG{o}{=}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{primary\PYGZus{}key}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{pk}\PYG{p}{\PYGZcb{}}\PYG{p}{)}

    \PYG{k}{def} \PYG{n+nf+fm}{\PYGZus{}\PYGZus{}str\PYGZus{}\PYGZus{}}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{return} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZob{}\PYGZcb{} \PYGZob{}\PYGZcb{} \PYGZob{}\PYGZcb{}, \PYGZob{}\PYGZcb{} id:\PYGZob{}\PYGZcb{} [\PYGZob{}\PYGZcb{}]}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}
            \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{amount}\PYG{p}{,} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{get\PYGZus{}sex\PYGZus{}display}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{animal\PYGZus{}type}\PYG{p}{,} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{line}\PYG{p}{,} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{pk}\PYG{p}{,} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{day\PYGZus{}of\PYGZus{}birth}\PYG{p}{)}

    \PYG{k}{def} \PYG{n+nf}{description}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{)}\PYG{p}{:}
        \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{        Return description of this model}
\PYG{l+s+sd}{        \PYGZdq{}\PYGZdq{}\PYGZdq{}}
        \PYG{k}{return} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{id:\PYGZob{}\PYGZcb{}, lab\PYGZus{}id:\PYGZob{}\PYGZcb{}, available:\PYGZob{}\PYGZcb{}\PYGZhy{}\PYGZob{}\PYGZcb{}, location:\PYGZob{}\PYGZcb{}, mutations:\PYGZob{}\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}
            \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{database\PYGZus{}id}\PYG{p}{,} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{lab\PYGZus{}id}\PYG{p}{,} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{day\PYGZus{}of\PYGZus{}birth}\PYG{p}{,}
            \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{day\PYGZus{}of\PYGZus{}death}\PYG{p}{,} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{location}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{mutations}\PYG{p}{)}\PYG{p}{)}

\end{sphinxVerbatim}


\section{Views}
\label{\detokenize{index:module-animals.views}}\label{\detokenize{index:views}}\index{animals.views (module)}
Django Views contains all the functions for rendering objects (HTML display).
It also contains an RSS Feed generator class to create an RSS feed from newly created animals
\begin{description}
\item[{\sphinxstylestrong{Important}:}] \leavevmode
When adding new functions, use the login\_required decorator
When adding new classes, use the LoginRequiredMixin

\end{description}
\index{AnimalDetailView (class in animals.views)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.views.AnimalDetailView}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{animals.views.}}\sphinxbfcode{\sphinxupquote{AnimalDetailView}}}{\emph{**kwargs}}{}
Detail view for an animal.
This is rarely used, rather use the claim page.
\index{model (animals.views.AnimalDetailView attribute)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.views.AnimalDetailView.model}}\pysigline{\sphinxbfcode{\sphinxupquote{model}}}
alias of \sphinxcode{\sphinxupquote{animals.models.Animal}}

\end{fulllineitems}


\end{fulllineitems}

\index{AnimalIndexView (class in animals.views)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.views.AnimalIndexView}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{animals.views.}}\sphinxbfcode{\sphinxupquote{AnimalIndexView}}}{\emph{**kwargs}}{}
Index / List view for all available animals.
Generic ListView using the LoginRequiredMixin
\begin{quote}\begin{description}
\item[{Parameters}] \leavevmode\begin{itemize}
\item {} 
\sphinxstyleliteralstrong{\sphinxupquote{q}} \textendash{} query / search term to filter the results

\item {} 
\sphinxstyleliteralstrong{\sphinxupquote{show}} \textendash{} limit the results to ‘current’, ‘archive’, or all animals

\end{itemize}

\end{description}\end{quote}
\index{get\_queryset() (animals.views.AnimalIndexView method)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.views.AnimalIndexView.get_queryset}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{get\_queryset}}}{}{}
Return the latest additions to the Animals table

\end{fulllineitems}

\index{model (animals.views.AnimalIndexView attribute)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.views.AnimalIndexView.model}}\pysigline{\sphinxbfcode{\sphinxupquote{model}}}
alias of \sphinxcode{\sphinxupquote{animals.models.Animal}}

\end{fulllineitems}


\end{fulllineitems}

\index{LatestAnimalsFeed (class in animals.views)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.views.LatestAnimalsFeed}}\pysigline{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{animals.views.}}\sphinxbfcode{\sphinxupquote{LatestAnimalsFeed}}}
RSS Feed for new animals/organs.
\index{item\_description() (animals.views.LatestAnimalsFeed method)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.views.LatestAnimalsFeed.item_description}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{item\_description}}}{\emph{item}}{}
What to print as item description (use default description from model).

\end{fulllineitems}

\index{item\_title() (animals.views.LatestAnimalsFeed method)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.views.LatestAnimalsFeed.item_title}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{item\_title}}}{\emph{item}}{}
What to print as item title (use default \_\_str\_\_ of model).

\end{fulllineitems}

\index{items() (animals.views.LatestAnimalsFeed method)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.views.LatestAnimalsFeed.items}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{items}}}{}{}
Get latest animals as items.

\end{fulllineitems}


\end{fulllineitems}

\index{OrganIndexView (class in animals.views)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.views.OrganIndexView}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class }}\sphinxcode{\sphinxupquote{animals.views.}}\sphinxbfcode{\sphinxupquote{OrganIndexView}}}{\emph{**kwargs}}{}
Index / List view for all available Organs.
Generic ListView using the LoginRequiredMixin
\begin{quote}\begin{description}
\item[{Parameters}] \leavevmode\begin{itemize}
\item {} 
\sphinxstyleliteralstrong{\sphinxupquote{q}} \textendash{} query / search term to filter the results

\item {} 
\sphinxstyleliteralstrong{\sphinxupquote{show}} \textendash{} limit the results to ‘current’, ‘archive’, or all Organs

\end{itemize}

\end{description}\end{quote}
\index{get\_queryset() (animals.views.OrganIndexView method)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.views.OrganIndexView.get_queryset}}\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{get\_queryset}}}{}{}
Return the latest additions to the Organs table

\end{fulllineitems}

\index{model (animals.views.OrganIndexView attribute)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.views.OrganIndexView.model}}\pysigline{\sphinxbfcode{\sphinxupquote{model}}}
alias of \sphinxcode{\sphinxupquote{animals.models.Organ}}

\end{fulllineitems}


\end{fulllineitems}

\index{claim() (in module animals.views)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.views.claim}}\pysiglinewithargsret{\sphinxcode{\sphinxupquote{animals.views.}}\sphinxbfcode{\sphinxupquote{claim}}}{\emph{request}, \emph{primary\_key}}{}
View to claim an animal.
\begin{quote}\begin{description}
\item[{Parameters}] \leavevmode
\sphinxstyleliteralstrong{\sphinxupquote{primary\_key}} \textendash{} the id/pk of the animal to retrieve

\item[{Returns}] \leavevmode
rendered page with the claim form
or 404 if animal not found

\end{description}\end{quote}

\end{fulllineitems}

\index{claim\_organ() (in module animals.views)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.views.claim_organ}}\pysiglinewithargsret{\sphinxcode{\sphinxupquote{animals.views.}}\sphinxbfcode{\sphinxupquote{claim\_organ}}}{\emph{request}, \emph{primary\_key}}{}
View to claim an organ.
\begin{quote}\begin{description}
\item[{Parameters}] \leavevmode
\sphinxstyleliteralstrong{\sphinxupquote{primary\_key}} \textendash{} the id/pk of the organ to retrieve

\item[{Returns}] \leavevmode
rendered page with the claim form
or 404 if organ not found

\end{description}\end{quote}

\end{fulllineitems}

\index{send\_email\_animal() (in module animals.views)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.views.send_email_animal}}\pysiglinewithargsret{\sphinxcode{\sphinxupquote{animals.views.}}\sphinxbfcode{\sphinxupquote{send\_email\_animal}}}{\emph{request}}{}
Function to send an email about an animal being claimed.

Needs these variables in the POST request: email, pk, count
\begin{quote}\begin{description}
\item[{Parameters}] \leavevmode\begin{itemize}
\item {} 
\sphinxstyleliteralstrong{\sphinxupquote{email}} \textendash{} email address of the request user / new owner

\item {} 
\sphinxstyleliteralstrong{\sphinxupquote{pk}} \textendash{} primary\_key of the animal(s) to be claimed

\item {} 
\sphinxstyleliteralstrong{\sphinxupquote{count}} \textendash{} how many animals are being claimed

\end{itemize}

\end{description}\end{quote}

\end{fulllineitems}

\index{send\_email\_organ() (in module animals.views)}

\begin{fulllineitems}
\phantomsection\label{\detokenize{index:animals.views.send_email_organ}}\pysiglinewithargsret{\sphinxcode{\sphinxupquote{animals.views.}}\sphinxbfcode{\sphinxupquote{send\_email\_organ}}}{\emph{request}}{}
Function to send an email about an animal being claimed.

Needs these variables in the POST request: email, pk, count
\begin{quote}\begin{description}
\item[{Parameters}] \leavevmode\begin{itemize}
\item {} 
\sphinxstyleliteralstrong{\sphinxupquote{email}} \textendash{} email address of the request user / new owner

\item {} 
\sphinxstyleliteralstrong{\sphinxupquote{pk}} \textendash{} primary\_key of the animal(s) to be claimed

\item {} 
\sphinxstyleliteralstrong{\sphinxupquote{organs\_wanted}} \textendash{} organs wanted from the given animal

\end{itemize}

\end{description}\end{quote}

\end{fulllineitems}


\fvset{hllines={, ,}}%
\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{Django Views contains all the functions for rendering objects (HTML display).}
\PYG{l+s+sd}{It also contains an RSS Feed generator class to create an RSS feed from newly created animals}

\PYG{l+s+sd}{**Important**:}
\PYG{l+s+sd}{    When adding new functions, use the login\PYGZus{}required decorator}
\PYG{l+s+sd}{    When adding new classes, use the LoginRequiredMixin}
\PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{k+kn}{import} \PYG{n+nn}{operator}
\PYG{k+kn}{from} \PYG{n+nn}{functools} \PYG{k+kn}{import} \PYG{n+nb}{reduce}
\PYG{k+kn}{from} \PYG{n+nn}{datetime} \PYG{k+kn}{import} \PYG{n}{datetime}
\PYG{k+kn}{from} \PYG{n+nn}{django} \PYG{k+kn}{import} \PYG{n}{forms}
\PYG{k+kn}{from} \PYG{n+nn}{django.contrib} \PYG{k+kn}{import} \PYG{n}{messages}
\PYG{k+kn}{from} \PYG{n+nn}{django.contrib.auth.decorators} \PYG{k+kn}{import} \PYG{n}{login\PYGZus{}required}
\PYG{k+kn}{from} \PYG{n+nn}{django.contrib.auth.mixins} \PYG{k+kn}{import} \PYG{n}{LoginRequiredMixin}
\PYG{k+kn}{from} \PYG{n+nn}{django.contrib.syndication.views} \PYG{k+kn}{import} \PYG{n}{Feed}
\PYG{k+kn}{from} \PYG{n+nn}{django.db.models} \PYG{k+kn}{import} \PYG{n}{Q}
\PYG{k+kn}{from} \PYG{n+nn}{django.core.mail} \PYG{k+kn}{import} \PYG{n}{EmailMessage}
\PYG{k+kn}{from} \PYG{n+nn}{django.http} \PYG{k+kn}{import} \PYG{n}{HttpResponse}
\PYG{k+kn}{from} \PYG{n+nn}{django.http} \PYG{k+kn}{import} \PYG{n}{HttpResponseRedirect}
\PYG{k+kn}{from} \PYG{n+nn}{django.shortcuts} \PYG{k+kn}{import} \PYG{n}{get\PYGZus{}object\PYGZus{}or\PYGZus{}404}\PYG{p}{,} \PYG{n}{render}
\PYG{k+kn}{from} \PYG{n+nn}{django.template.loader} \PYG{k+kn}{import} \PYG{n}{render\PYGZus{}to\PYGZus{}string}
\PYG{c+c1}{\PYGZsh{}from django.urls import reverse}
\PYG{k+kn}{from} \PYG{n+nn}{django.views} \PYG{k+kn}{import} \PYG{n}{generic}

\PYG{k+kn}{from} \PYG{n+nn}{.filters} \PYG{k+kn}{import} \PYG{n}{AnimalFilter}
\PYG{k+kn}{from} \PYG{n+nn}{.models} \PYG{k+kn}{import} \PYG{n}{Animal}\PYG{p}{,} \PYG{n}{Organ}

\PYG{n+nd}{@login\PYGZus{}required}
\PYG{k}{def} \PYG{n+nf}{claim}\PYG{p}{(}\PYG{n}{request}\PYG{p}{,} \PYG{n}{primary\PYGZus{}key}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    View to claim an animal.}

\PYG{l+s+sd}{    :param primary\PYGZus{}key: the id/pk of the animal to retrieve}

\PYG{l+s+sd}{    :returns: rendered page with the claim form}
\PYG{l+s+sd}{              or 404 if animal not found}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{n}{animal} \PYG{o}{=} \PYG{n}{get\PYGZus{}object\PYGZus{}or\PYGZus{}404}\PYG{p}{(}\PYG{n}{Animal}\PYG{p}{,} \PYG{n}{pk}\PYG{o}{=}\PYG{n}{primary\PYGZus{}key}\PYG{p}{)}
    \PYG{k}{return} \PYG{n}{render}\PYG{p}{(}\PYG{n}{request}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{animals/animal\PYGZhy{}claim.html}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{object}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{animal}\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n+nd}{@login\PYGZus{}required}
\PYG{k}{def} \PYG{n+nf}{claim\PYGZus{}organ}\PYG{p}{(}\PYG{n}{request}\PYG{p}{,} \PYG{n}{primary\PYGZus{}key}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    View to claim an organ.}

\PYG{l+s+sd}{    :param primary\PYGZus{}key: the id/pk of the organ to retrieve}

\PYG{l+s+sd}{    :returns: rendered page with the claim form}
\PYG{l+s+sd}{              or 404 if organ not found}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{n}{organ} \PYG{o}{=} \PYG{n}{get\PYGZus{}object\PYGZus{}or\PYGZus{}404}\PYG{p}{(}\PYG{n}{Organ}\PYG{p}{,} \PYG{n}{pk}\PYG{o}{=}\PYG{n}{primary\PYGZus{}key}\PYG{p}{)}
    \PYG{k}{return} \PYG{n}{render}\PYG{p}{(}\PYG{n}{request}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{animals/organ\PYGZhy{}claim.html}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{object}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{organ}\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{k}{class} \PYG{n+nc}{AnimalDetailView}\PYG{p}{(}\PYG{n}{LoginRequiredMixin}\PYG{p}{,} \PYG{n}{generic}\PYG{o}{.}\PYG{n}{DetailView}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    Detail view for an animal.}
\PYG{l+s+sd}{    This is rarely used, rather use the claim page.}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{n}{model} \PYG{o}{=} \PYG{n}{Animal}
    \PYG{n}{template\PYGZus{}name} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{animals/animal\PYGZhy{}detail.html}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{k}{class} \PYG{n+nc}{AnimalIndexView}\PYG{p}{(}\PYG{n}{LoginRequiredMixin}\PYG{p}{,} \PYG{n}{generic}\PYG{o}{.}\PYG{n}{ListView}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    Index / List view for all available animals.}
\PYG{l+s+sd}{    Generic ListView using the LoginRequiredMixin}

\PYG{l+s+sd}{    :param q: query / search term to filter the results}
\PYG{l+s+sd}{    :param show: limit the results to \PYGZsq{}current\PYGZsq{}, \PYGZsq{}archive\PYGZsq{}, or all animals}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{n}{model} \PYG{o}{=} \PYG{n}{Animal}
    \PYG{n}{template\PYGZus{}name} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{animals/index.html}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{n}{context\PYGZus{}object\PYGZus{}name} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{all\PYGZus{}animals}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{n}{paginate\PYGZus{}by} \PYG{o}{=} \PYG{l+m+mi}{100}
    \PYG{k}{def} \PYG{n+nf}{get\PYGZus{}queryset}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{)}\PYG{p}{:}
        \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}Return the latest additions to the Animals table\PYGZdq{}\PYGZdq{}\PYGZdq{}}
        \PYG{n}{result} \PYG{o}{=} \PYG{n+nb}{super}\PYG{p}{(}\PYG{n}{AnimalIndexView}\PYG{p}{,} \PYG{n+nb+bp}{self}\PYG{p}{)}\PYG{o}{.}\PYG{n}{get\PYGZus{}queryset}\PYG{p}{(}\PYG{p}{)}
        \PYG{n}{query} \PYG{o}{=} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{request}\PYG{o}{.}\PYG{n}{GET}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{q}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{k}{if} \PYG{n}{query}\PYG{p}{:}
            \PYG{n}{query\PYGZus{}list} \PYG{o}{=} \PYG{n}{query}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}
            \PYG{n}{result} \PYG{o}{=} \PYG{n}{result}\PYG{o}{.}\PYG{n}{filter}\PYG{p}{(}
                \PYG{n+nb}{reduce}\PYG{p}{(}\PYG{n}{operator}\PYG{o}{.}\PYG{n}{and\PYGZus{}}\PYG{p}{,} \PYG{p}{(}\PYG{n}{Q}\PYG{p}{(}\PYG{n}{comment\PYGZus{}\PYGZus{}icontains}\PYG{o}{=}\PYG{n}{q}\PYG{p}{)} \PYG{k}{for} \PYG{n}{q} \PYG{o+ow}{in} \PYG{n}{query\PYGZus{}list}\PYG{p}{)}\PYG{p}{)} \PYG{o}{\textbar{}}
                \PYG{n+nb}{reduce}\PYG{p}{(}\PYG{n}{operator}\PYG{o}{.}\PYG{n}{and\PYGZus{}}\PYG{p}{,} \PYG{p}{(}\PYG{n}{Q}\PYG{p}{(}\PYG{n}{mutations\PYGZus{}\PYGZus{}icontains}\PYG{o}{=}\PYG{n}{q}\PYG{p}{)} \PYG{k}{for} \PYG{n}{q} \PYG{o+ow}{in} \PYG{n}{query\PYGZus{}list}\PYG{p}{)}\PYG{p}{)} \PYG{o}{\textbar{}}
                \PYG{n+nb}{reduce}\PYG{p}{(}\PYG{n}{operator}\PYG{o}{.}\PYG{n}{and\PYGZus{}}\PYG{p}{,} \PYG{p}{(}\PYG{n}{Q}\PYG{p}{(}\PYG{n}{database\PYGZus{}id\PYGZus{}\PYGZus{}icontains}\PYG{o}{=}\PYG{n}{q}\PYG{p}{)} \PYG{k}{for} \PYG{n}{q} \PYG{o+ow}{in} \PYG{n}{query\PYGZus{}list}\PYG{p}{)}\PYG{p}{)} \PYG{o}{\textbar{}}
                \PYG{n+nb}{reduce}\PYG{p}{(}\PYG{n}{operator}\PYG{o}{.}\PYG{n}{and\PYGZus{}}\PYG{p}{,} \PYG{p}{(}\PYG{n}{Q}\PYG{p}{(}\PYG{n}{line\PYGZus{}\PYGZus{}icontains}\PYG{o}{=}\PYG{n}{q}\PYG{p}{)} \PYG{k}{for} \PYG{n}{q} \PYG{o+ow}{in} \PYG{n}{query\PYGZus{}list}\PYG{p}{)}\PYG{p}{)} \PYG{o}{\textbar{}}
                \PYG{n+nb}{reduce}\PYG{p}{(}\PYG{n}{operator}\PYG{o}{.}\PYG{n}{and\PYGZus{}}\PYG{p}{,} \PYG{p}{(}\PYG{n}{Q}\PYG{p}{(}\PYG{n}{lab\PYGZus{}id\PYGZus{}\PYGZus{}icontains}\PYG{o}{=}\PYG{n}{q}\PYG{p}{)} \PYG{k}{for} \PYG{n}{q} \PYG{o+ow}{in} \PYG{n}{query\PYGZus{}list}\PYG{p}{)}\PYG{p}{)} \PYG{o}{\textbar{}}
                \PYG{n+nb}{reduce}\PYG{p}{(}\PYG{n}{operator}\PYG{o}{.}\PYG{n}{and\PYGZus{}}\PYG{p}{,} \PYG{p}{(}\PYG{n}{Q}\PYG{p}{(}\PYG{n}{location\PYGZus{}\PYGZus{}name\PYGZus{}\PYGZus{}icontains}\PYG{o}{=}\PYG{n}{q}\PYG{p}{)} \PYG{k}{for} \PYG{n}{q} \PYG{o+ow}{in} \PYG{n}{query\PYGZus{}list}\PYG{p}{)}\PYG{p}{)} \PYG{o}{\textbar{}}
                \PYG{n+nb}{reduce}\PYG{p}{(}\PYG{n}{operator}\PYG{o}{.}\PYG{n}{and\PYGZus{}}\PYG{p}{,} \PYG{p}{(}\PYG{n}{Q}\PYG{p}{(}\PYG{n}{new\PYGZus{}owner\PYGZus{}\PYGZus{}icontains}\PYG{o}{=}\PYG{n}{q}\PYG{p}{)} \PYG{k}{for} \PYG{n}{q} \PYG{o+ow}{in} \PYG{n}{query\PYGZus{}list}\PYG{p}{)}\PYG{p}{)} \PYG{o}{\textbar{}}
                \PYG{n+nb}{reduce}\PYG{p}{(}\PYG{n}{operator}\PYG{o}{.}\PYG{n}{and\PYGZus{}}\PYG{p}{,} \PYG{p}{(}\PYG{n}{Q}\PYG{p}{(}\PYG{n}{responsible\PYGZus{}person\PYGZus{}\PYGZus{}name\PYGZus{}\PYGZus{}icontains}\PYG{o}{=}\PYG{n}{q}\PYG{p}{)} \PYG{k}{for} \PYG{n}{q} \PYG{o+ow}{in} \PYG{n}{query\PYGZus{}list}\PYG{p}{)}\PYG{p}{)} \PYG{o}{\textbar{}}
                \PYG{n+nb}{reduce}\PYG{p}{(}\PYG{n}{operator}\PYG{o}{.}\PYG{n}{and\PYGZus{}}\PYG{p}{,} \PYG{p}{(}\PYG{n}{Q}\PYG{p}{(}\PYG{n}{licence\PYGZus{}number\PYGZus{}\PYGZus{}icontains}\PYG{o}{=}\PYG{n}{q}\PYG{p}{)} \PYG{k}{for} \PYG{n}{q} \PYG{o+ow}{in} \PYG{n}{query\PYGZus{}list}\PYG{p}{)}\PYG{p}{)}
            \PYG{p}{)}
            \PYG{k}{return} \PYG{n}{result}
        \PYG{k}{try}\PYG{p}{:}
            \PYG{n}{show} \PYG{o}{=} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{kwargs}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{show}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
        \PYG{k}{except} \PYG{n+ne}{KeyError}\PYG{p}{:}
            \PYG{n}{show} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{current}\PYG{l+s+s1}{\PYGZsq{}}
        \PYG{k}{if} \PYG{n}{show} \PYG{o}{==} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{archive}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}
            \PYG{k}{return} \PYG{n}{Animal}\PYG{o}{.}\PYG{n}{objects}\PYG{o}{.}\PYG{n}{filter}\PYG{p}{(}\PYG{n}{available\PYGZus{}to\PYGZus{}\PYGZus{}lte}\PYG{o}{=}\PYG{n}{datetime}\PYG{o}{.}\PYG{n}{now}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{date}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}\PYG{n}{order\PYGZus{}by}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}entry\PYGZus{}date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{k}{elif} \PYG{n}{show} \PYG{o}{==} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{current}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}
            \PYG{k}{return} \PYG{n}{Animal}\PYG{o}{.}\PYG{n}{objects}\PYG{o}{.}\PYG{n}{filter}\PYG{p}{(}\PYG{n}{available\PYGZus{}to\PYGZus{}\PYGZus{}gte}\PYG{o}{=}\PYG{n}{datetime}\PYG{o}{.}\PYG{n}{now}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{date}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}\PYG{n}{order\PYGZus{}by}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}entry\PYGZus{}date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{k}{return} \PYG{n}{Animal}\PYG{o}{.}\PYG{n}{objects}\PYG{o}{.}\PYG{n}{order\PYGZus{}by}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}entry\PYGZus{}date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{k}{class} \PYG{n+nc}{OrganIndexView}\PYG{p}{(}\PYG{n}{LoginRequiredMixin}\PYG{p}{,} \PYG{n}{generic}\PYG{o}{.}\PYG{n}{ListView}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    Index / List view for all available Organs.}
\PYG{l+s+sd}{    Generic ListView using the LoginRequiredMixin}

\PYG{l+s+sd}{    :param q: query / search term to filter the results}
\PYG{l+s+sd}{    :param show: limit the results to \PYGZsq{}current\PYGZsq{}, \PYGZsq{}archive\PYGZsq{}, or all Organs}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{n}{model} \PYG{o}{=} \PYG{n}{Organ}
    \PYG{n}{template\PYGZus{}name} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{animals/organs.html}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{n}{context\PYGZus{}object\PYGZus{}name} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{all\PYGZus{}organs}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{n}{paginate\PYGZus{}by} \PYG{o}{=} \PYG{l+m+mi}{100}
    \PYG{k}{def} \PYG{n+nf}{get\PYGZus{}queryset}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{)}\PYG{p}{:}
        \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}Return the latest additions to the Organs table\PYGZdq{}\PYGZdq{}\PYGZdq{}}
        \PYG{n}{result} \PYG{o}{=} \PYG{n+nb}{super}\PYG{p}{(}\PYG{n}{OrganIndexView}\PYG{p}{,} \PYG{n+nb+bp}{self}\PYG{p}{)}\PYG{o}{.}\PYG{n}{get\PYGZus{}queryset}\PYG{p}{(}\PYG{p}{)}
        \PYG{n}{query} \PYG{o}{=} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{request}\PYG{o}{.}\PYG{n}{GET}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{q}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{k}{if} \PYG{n}{query}\PYG{p}{:}
            \PYG{n}{query\PYGZus{}list} \PYG{o}{=} \PYG{n}{query}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}
            \PYG{n}{result} \PYG{o}{=} \PYG{n}{result}\PYG{o}{.}\PYG{n}{filter}\PYG{p}{(}
                \PYG{n+nb}{reduce}\PYG{p}{(}\PYG{n}{operator}\PYG{o}{.}\PYG{n}{and\PYGZus{}}\PYG{p}{,} \PYG{p}{(}\PYG{n}{Q}\PYG{p}{(}\PYG{n}{comment\PYGZus{}\PYGZus{}icontains}\PYG{o}{=}\PYG{n}{q}\PYG{p}{)} \PYG{k}{for} \PYG{n}{q} \PYG{o+ow}{in} \PYG{n}{query\PYGZus{}list}\PYG{p}{)}\PYG{p}{)} \PYG{o}{\textbar{}}
                \PYG{n+nb}{reduce}\PYG{p}{(}\PYG{n}{operator}\PYG{o}{.}\PYG{n}{and\PYGZus{}}\PYG{p}{,} \PYG{p}{(}\PYG{n}{Q}\PYG{p}{(}\PYG{n}{mutations\PYGZus{}\PYGZus{}icontains}\PYG{o}{=}\PYG{n}{q}\PYG{p}{)} \PYG{k}{for} \PYG{n}{q} \PYG{o+ow}{in} \PYG{n}{query\PYGZus{}list}\PYG{p}{)}\PYG{p}{)} \PYG{o}{\textbar{}}
                \PYG{n+nb}{reduce}\PYG{p}{(}\PYG{n}{operator}\PYG{o}{.}\PYG{n}{and\PYGZus{}}\PYG{p}{,} \PYG{p}{(}\PYG{n}{Q}\PYG{p}{(}\PYG{n}{database\PYGZus{}id\PYGZus{}\PYGZus{}icontains}\PYG{o}{=}\PYG{n}{q}\PYG{p}{)} \PYG{k}{for} \PYG{n}{q} \PYG{o+ow}{in} \PYG{n}{query\PYGZus{}list}\PYG{p}{)}\PYG{p}{)} \PYG{o}{\textbar{}}
                \PYG{n+nb}{reduce}\PYG{p}{(}\PYG{n}{operator}\PYG{o}{.}\PYG{n}{and\PYGZus{}}\PYG{p}{,} \PYG{p}{(}\PYG{n}{Q}\PYG{p}{(}\PYG{n}{line\PYGZus{}\PYGZus{}icontains}\PYG{o}{=}\PYG{n}{q}\PYG{p}{)} \PYG{k}{for} \PYG{n}{q} \PYG{o+ow}{in} \PYG{n}{query\PYGZus{}list}\PYG{p}{)}\PYG{p}{)} \PYG{o}{\textbar{}}
                \PYG{n+nb}{reduce}\PYG{p}{(}\PYG{n}{operator}\PYG{o}{.}\PYG{n}{and\PYGZus{}}\PYG{p}{,} \PYG{p}{(}\PYG{n}{Q}\PYG{p}{(}\PYG{n}{lab\PYGZus{}id\PYGZus{}\PYGZus{}icontains}\PYG{o}{=}\PYG{n}{q}\PYG{p}{)} \PYG{k}{for} \PYG{n}{q} \PYG{o+ow}{in} \PYG{n}{query\PYGZus{}list}\PYG{p}{)}\PYG{p}{)} \PYG{o}{\textbar{}}
                \PYG{n+nb}{reduce}\PYG{p}{(}\PYG{n}{operator}\PYG{o}{.}\PYG{n}{and\PYGZus{}}\PYG{p}{,} \PYG{p}{(}\PYG{n}{Q}\PYG{p}{(}\PYG{n}{location\PYGZus{}\PYGZus{}name\PYGZus{}\PYGZus{}icontains}\PYG{o}{=}\PYG{n}{q}\PYG{p}{)} \PYG{k}{for} \PYG{n}{q} \PYG{o+ow}{in} \PYG{n}{query\PYGZus{}list}\PYG{p}{)}\PYG{p}{)} \PYG{o}{\textbar{}}
                \PYG{n+nb}{reduce}\PYG{p}{(}\PYG{n}{operator}\PYG{o}{.}\PYG{n}{and\PYGZus{}}\PYG{p}{,} \PYG{p}{(}\PYG{n}{Q}\PYG{p}{(}\PYG{n}{killing\PYGZus{}person\PYGZus{}\PYGZus{}icontains}\PYG{o}{=}\PYG{n}{q}\PYG{p}{)} \PYG{k}{for} \PYG{n}{q} \PYG{o+ow}{in} \PYG{n}{query\PYGZus{}list}\PYG{p}{)}\PYG{p}{)} \PYG{o}{\textbar{}}
                \PYG{n+nb}{reduce}\PYG{p}{(}\PYG{n}{operator}\PYG{o}{.}\PYG{n}{and\PYGZus{}}\PYG{p}{,} \PYG{p}{(}\PYG{n}{Q}\PYG{p}{(}\PYG{n}{animal\PYGZus{}type\PYGZus{}\PYGZus{}icontains}\PYG{o}{=}\PYG{n}{q}\PYG{p}{)} \PYG{k}{for} \PYG{n}{q} \PYG{o+ow}{in} \PYG{n}{query\PYGZus{}list}\PYG{p}{)}\PYG{p}{)} \PYG{o}{\textbar{}}
                \PYG{n+nb}{reduce}\PYG{p}{(}\PYG{n}{operator}\PYG{o}{.}\PYG{n}{and\PYGZus{}}\PYG{p}{,} \PYG{p}{(}\PYG{n}{Q}\PYG{p}{(}\PYG{n}{method\PYGZus{}of\PYGZus{}killing\PYGZus{}\PYGZus{}icontains}\PYG{o}{=}\PYG{n}{q}\PYG{p}{)} \PYG{k}{for} \PYG{n}{q} \PYG{o+ow}{in} \PYG{n}{query\PYGZus{}list}\PYG{p}{)}\PYG{p}{)} \PYG{o}{\textbar{}}
                \PYG{n+nb}{reduce}\PYG{p}{(}\PYG{n}{operator}\PYG{o}{.}\PYG{n}{and\PYGZus{}}\PYG{p}{,} \PYG{p}{(}\PYG{n}{Q}\PYG{p}{(}\PYG{n}{licence\PYGZus{}number\PYGZus{}\PYGZus{}icontains}\PYG{o}{=}\PYG{n}{q}\PYG{p}{)} \PYG{k}{for} \PYG{n}{q} \PYG{o+ow}{in} \PYG{n}{query\PYGZus{}list}\PYG{p}{)}\PYG{p}{)}
            \PYG{p}{)}
            \PYG{k}{return} \PYG{n}{result}
        \PYG{k}{return} \PYG{n}{Organ}\PYG{o}{.}\PYG{n}{objects}\PYG{o}{.}\PYG{n}{order\PYGZus{}by}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}entry\PYGZus{}date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{k}{def} \PYG{n+nf}{send\PYGZus{}email\PYGZus{}animal}\PYG{p}{(}\PYG{n}{request}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    Function to send an email about an animal being claimed.}

\PYG{l+s+sd}{    Needs these variables in the POST request: email, pk, count}

\PYG{l+s+sd}{    :param email: email address of the request user / new owner}
\PYG{l+s+sd}{    :param pk: primary\PYGZus{}key of the animal(s) to be claimed}
\PYG{l+s+sd}{    :param count: how many animals are being claimed}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{n}{email} \PYG{o}{=} \PYG{n}{request}\PYG{o}{.}\PYG{n}{POST}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{email}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
    \PYG{n}{primary\PYGZus{}key} \PYG{o}{=} \PYG{n}{request}\PYG{o}{.}\PYG{n}{POST}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{pk}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
    \PYG{n}{count} \PYG{o}{=} \PYG{n}{request}\PYG{o}{.}\PYG{n}{POST}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{count}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}

    \PYG{n}{animal} \PYG{o}{=} \PYG{n}{Animal}\PYG{o}{.}\PYG{n}{objects}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{pk}\PYG{o}{=}\PYG{n}{primary\PYGZus{}key}\PYG{p}{)}
    \PYG{n}{animal}\PYG{o}{.}\PYG{n}{new\PYGZus{}owner} \PYG{o}{=} \PYG{n}{email}
    \PYG{n}{amount\PYGZus{}difference} \PYG{o}{=} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{animal}\PYG{o}{.}\PYG{n}{amount}\PYG{p}{)}\PYG{o}{\PYGZhy{}}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{count}\PYG{p}{)}
    \PYG{k}{if} \PYG{n}{amount\PYGZus{}difference} \PYG{o}{\PYGZlt{}} \PYG{l+m+mi}{0}\PYG{p}{:}  \PYG{c+c1}{\PYGZsh{} Save remainder of animals as new object}
        \PYG{n}{messages}\PYG{o}{.}\PYG{n}{add\PYGZus{}message}\PYG{p}{(}\PYG{n}{request}\PYG{p}{,} \PYG{n}{messages}\PYG{o}{.}\PYG{n}{ERROR}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{You cannot claim more animals then are available!}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{k}{raise} \PYG{n}{forms}\PYG{o}{.}\PYG{n}{ValidationError}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{You cannot claim more animals then are available!}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{n}{animal}\PYG{o}{.}\PYG{n}{amount} \PYG{o}{=} \PYG{n}{count}
    \PYG{n}{animal}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{p}{)}  \PYG{c+c1}{\PYGZsh{} Save the animal with the new owner}
    \PYG{n}{messages}\PYG{o}{.}\PYG{n}{add\PYGZus{}message}\PYG{p}{(}\PYG{n}{request}\PYG{p}{,} \PYG{n}{messages}\PYG{o}{.}\PYG{n}{SUCCESS}\PYG{p}{,}
                         \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{The entry \PYGZob{}\PYGZcb{} has been claimed by \PYGZob{}\PYGZcb{}.}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{animal}\PYG{o}{.}\PYG{n}{pk}\PYG{p}{,} \PYG{n}{animal}\PYG{o}{.}\PYG{n}{new\PYGZus{}owner}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{subject} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{User \PYGZob{}\PYGZcb{} claimed animal \PYGZob{}\PYGZcb{} in AniShare}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{email}\PYG{p}{,} \PYG{n}{primary\PYGZus{}key}\PYG{p}{)}
    \PYG{n}{message} \PYG{o}{=} \PYG{n}{render\PYGZus{}to\PYGZus{}string}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{email.html}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{email}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{email}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{object}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{animal}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{now}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{datetime}\PYG{o}{.}\PYG{n}{now}\PYG{p}{(}\PYG{p}{)}\PYG{p}{\PYGZcb{}}\PYG{p}{)}

    \PYG{n}{msg} \PYG{o}{=} \PYG{n}{EmailMessage}\PYG{p}{(}\PYG{n}{subject}\PYG{p}{,} \PYG{n}{message}\PYG{p}{,} \PYG{n}{email}\PYG{p}{,} \PYG{p}{[}\PYG{n}{animal}\PYG{o}{.}\PYG{n}{responsible\PYGZus{}person}\PYG{o}{.}\PYG{n}{email}\PYG{p}{,} \PYG{n}{email}\PYG{p}{]}\PYG{p}{)}
    \PYG{n}{msg}\PYG{o}{.}\PYG{n}{content\PYGZus{}subtype} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{html}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{n}{msg}\PYG{o}{.}\PYG{n}{send}\PYG{p}{(}\PYG{p}{)}
    \PYG{k}{if} \PYG{n}{amount\PYGZus{}difference} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{0}\PYG{p}{:}  \PYG{c+c1}{\PYGZsh{} If there were multiple animals, save the remainder of animals as a new object}
        \PYG{n}{animal}\PYG{o}{.}\PYG{n}{pk} \PYG{o}{=} \PYG{n+nb+bp}{None}
        \PYG{n}{animal}\PYG{o}{.}\PYG{n}{amount} \PYG{o}{=} \PYG{n}{amount\PYGZus{}difference}
        \PYG{n}{animal}\PYG{o}{.}\PYG{n}{new\PYGZus{}owner} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}
        \PYG{n}{animal}\PYG{o}{.}\PYG{n}{save}\PYG{p}{(}\PYG{p}{)}
        \PYG{n}{messages}\PYG{o}{.}\PYG{n}{add\PYGZus{}message}\PYG{p}{(}\PYG{n}{request}\PYG{p}{,} \PYG{n}{messages}\PYG{o}{.}\PYG{n}{SUCCESS}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{The amount of available animals in this entry has been reduced to \PYGZob{}\PYGZcb{}.}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{animal}\PYG{o}{.}\PYG{n}{amount}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{messages}\PYG{o}{.}\PYG{n}{add\PYGZus{}message}\PYG{p}{(}\PYG{n}{request}\PYG{p}{,} \PYG{n}{messages}\PYG{o}{.}\PYG{n}{SUCCESS}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{An Email has been sent to \PYGZlt{}\PYGZob{}\PYGZcb{}\PYGZgt{}.}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{animal}\PYG{o}{.}\PYG{n}{responsible\PYGZus{}person}\PYG{o}{.}\PYG{n}{email}\PYG{p}{)}\PYG{p}{)}

    \PYG{k}{return} \PYG{n}{HttpResponseRedirect}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{k}{def} \PYG{n+nf}{send\PYGZus{}email\PYGZus{}organ}\PYG{p}{(}\PYG{n}{request}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    Function to send an email about an animal being claimed.}

\PYG{l+s+sd}{    Needs these variables in the POST request: email, pk, count}

\PYG{l+s+sd}{    :param email: email address of the request user / new owner}
\PYG{l+s+sd}{    :param pk: primary\PYGZus{}key of the animal(s) to be claimed}
\PYG{l+s+sd}{    :param organs\PYGZus{}wanted: organs wanted from the given animal}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{n}{email} \PYG{o}{=} \PYG{n}{request}\PYG{o}{.}\PYG{n}{POST}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{email}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
    \PYG{n}{primary\PYGZus{}key} \PYG{o}{=} \PYG{n}{request}\PYG{o}{.}\PYG{n}{POST}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{pk}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
    \PYG{n}{organs\PYGZus{}wanted} \PYG{o}{=} \PYG{n}{request}\PYG{o}{.}\PYG{n}{POST}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{organs\PYGZus{}wanted}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}

    \PYG{n}{organ} \PYG{o}{=} \PYG{n}{Organ}\PYG{o}{.}\PYG{n}{objects}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{pk}\PYG{o}{=}\PYG{n}{primary\PYGZus{}key}\PYG{p}{)}
    \PYG{n}{subject} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{AniShare User \PYGZob{}\PYGZcb{} claimed organ(s) \PYGZob{}\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{email}\PYG{p}{,} \PYG{n}{organs\PYGZus{}wanted}\PYG{p}{)}
    \PYG{n}{message} \PYG{o}{=} \PYG{n}{render\PYGZus{}to\PYGZus{}string}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{email.html}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{email}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{email}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{organs\PYGZus{}wanted}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{n}{organs\PYGZus{}wanted}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{object}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{organ}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{now}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{datetime}\PYG{o}{.}\PYG{n}{now}\PYG{p}{(}\PYG{p}{)}\PYG{p}{\PYGZcb{}}\PYG{p}{)}

    \PYG{n}{msg} \PYG{o}{=} \PYG{n}{EmailMessage}\PYG{p}{(}\PYG{n}{subject}\PYG{p}{,} \PYG{n}{message}\PYG{p}{,} \PYG{n}{email}\PYG{p}{,} \PYG{p}{[}\PYG{n}{organ}\PYG{o}{.}\PYG{n}{responsible\PYGZus{}person}\PYG{o}{.}\PYG{n}{email}\PYG{p}{,} \PYG{n}{email}\PYG{p}{]}\PYG{p}{)}
    \PYG{n}{msg}\PYG{o}{.}\PYG{n}{content\PYGZus{}subtype} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{html}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{n}{msg}\PYG{o}{.}\PYG{n}{send}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{messages}\PYG{o}{.}\PYG{n}{add\PYGZus{}message}\PYG{p}{(}\PYG{n}{request}\PYG{p}{,} \PYG{n}{messages}\PYG{o}{.}\PYG{n}{SUCCESS}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{An Email has been sent to \PYGZlt{}\PYGZob{}\PYGZcb{}\PYGZgt{}.}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{organ}\PYG{o}{.}\PYG{n}{responsible\PYGZus{}person}\PYG{o}{.}\PYG{n}{email}\PYG{p}{)}\PYG{p}{)}

    \PYG{k}{return} \PYG{n}{HttpResponseRedirect}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/organs/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}


\PYG{k}{class} \PYG{n+nc}{LatestAnimalsFeed}\PYG{p}{(}\PYG{n}{Feed}\PYG{p}{)}\PYG{p}{:}
    \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    RSS Feed for new animals/organs.}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{n}{title} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Anishare animal/organ feed}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{n}{link} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/animals/feed}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{n}{description} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Updates on animals/organs to share.}\PYG{l+s+s1}{\PYGZsq{}}

    \PYG{k}{def} \PYG{n+nf+fm}{\PYGZus{}\PYGZus{}call\PYGZus{}\PYGZus{}}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{,} \PYG{n}{request}\PYG{p}{,} \PYG{o}{*}\PYG{n}{args}\PYG{p}{,} \PYG{o}{*}\PYG{o}{*}\PYG{n}{kwargs}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{if} \PYG{o+ow}{not} \PYG{n}{request}\PYG{o}{.}\PYG{n}{user}\PYG{o}{.}\PYG{n}{is\PYGZus{}authenticated}\PYG{p}{:}
            \PYG{k}{return} \PYG{n}{HttpResponse}\PYG{p}{(}\PYG{n}{status}\PYG{o}{=}\PYG{l+m+mi}{401}\PYG{p}{)}
        \PYG{k}{return} \PYG{n+nb}{super}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n+nf+fm}{\PYGZus{}\PYGZus{}call\PYGZus{}\PYGZus{}}\PYG{p}{(}\PYG{n}{request}\PYG{p}{,} \PYG{o}{*}\PYG{n}{args}\PYG{p}{,} \PYG{o}{*}\PYG{o}{*}\PYG{n}{kwargs}\PYG{p}{)}

    \PYG{k}{def} \PYG{n+nf}{items}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{)}\PYG{p}{:}
        \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{        Get latest animals as items.}
\PYG{l+s+sd}{        \PYGZdq{}\PYGZdq{}\PYGZdq{}}
        \PYG{k+kn}{from} \PYG{n+nn}{itertools} \PYG{k+kn}{import} \PYG{n}{chain}
        \PYG{n}{animals} \PYG{o}{=} \PYG{n}{Animal}\PYG{o}{.}\PYG{n}{objects}\PYG{o}{.}\PYG{n}{order\PYGZus{}by}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}entry\PYGZus{}date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{[}\PYG{p}{:}\PYG{l+m+mi}{10}\PYG{p}{]}
        \PYG{n}{organs} \PYG{o}{=} \PYG{n}{Organ}\PYG{o}{.}\PYG{n}{objects}\PYG{o}{.}\PYG{n}{order\PYGZus{}by}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}entry\PYGZus{}date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{[}\PYG{p}{:}\PYG{l+m+mi}{10}\PYG{p}{]}
        \PYG{k}{return} \PYG{n}{chain}\PYG{p}{(}\PYG{n}{animals}\PYG{p}{,} \PYG{n}{organs}\PYG{p}{)}

    \PYG{k}{def} \PYG{n+nf}{item\PYGZus{}title}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{,} \PYG{n}{item}\PYG{p}{)}\PYG{p}{:}
        \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{        What to print as item title (use default \PYGZus{}\PYGZus{}str\PYGZus{}\PYGZus{} of model).}
\PYG{l+s+sd}{        \PYGZdq{}\PYGZdq{}\PYGZdq{}}
        \PYG{k}{return} \PYG{n}{item}

    \PYG{k}{def} \PYG{n+nf}{item\PYGZus{}description}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{,} \PYG{n}{item}\PYG{p}{)}\PYG{p}{:}
        \PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{        What to print as item description (use default description from model).}
\PYG{l+s+sd}{        \PYGZdq{}\PYGZdq{}\PYGZdq{}}
        \PYG{k}{return} \PYG{n}{item}\PYG{o}{.}\PYG{n}{description}\PYG{p}{(}\PYG{p}{)}

\PYG{n+nd}{@login\PYGZus{}required}
\PYG{k}{def} \PYG{n+nf}{animal\PYGZus{}list}\PYG{p}{(}\PYG{n}{request}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{f} \PYG{o}{=} \PYG{n}{AnimalFilter}\PYG{p}{(}\PYG{n}{request}\PYG{o}{.}\PYG{n}{GET}\PYG{p}{,} \PYG{n}{queryset}\PYG{o}{=}\PYG{n}{Animal}\PYG{o}{.}\PYG{n}{objects}\PYG{o}{.}\PYG{n}{order\PYGZus{}by}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}entry\PYGZus{}date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
    \PYG{k}{return} \PYG{n}{render}\PYG{p}{(}\PYG{n}{request}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{animals/animal\PYGZhy{}index.html}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{filter}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{f}\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\end{sphinxVerbatim}


\section{URLs}
\label{\detokenize{index:module-animals.urls}}\label{\detokenize{index:urls}}\index{animals.urls (module)}
animals URL Configuration
\begin{description}
\item[{The \sphinxtitleref{urlpatterns} list routes URLs to views. For more information please see:}] \leavevmode
\sphinxurl{https://docs.djangoproject.com/en/2.0/topics/http/urls/}

\end{description}

Examples:
\begin{description}
\item[{Function views:}] \leavevmode\begin{enumerate}
\item {} 
Add an import:  from my\_app import views

\item {} 
Add a URL to urlpatterns:  path(‘’, views.home, name=’home’)

\end{enumerate}

\item[{Class-based views:}] \leavevmode\begin{enumerate}
\item {} 
Add an import:  from other\_app.views import Home

\item {} 
Add a URL to urlpatterns:  path(‘’, Home.as\_view(), name=’home’)

\end{enumerate}

\item[{Including another URLconf:}] \leavevmode\begin{enumerate}
\item {} 
Import the include() function: from django.urls import include, path

\item {} 
Add a URL to urlpatterns:  path(‘blog/’, include(‘blog.urls’))

\end{enumerate}

\end{description}

\fvset{hllines={, ,}}%
\begin{sphinxVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1]
\PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}animals URL Configuration}

\PYG{l+s+sd}{The {}`urlpatterns{}` list routes URLs to views. For more information please see:}
\PYG{l+s+sd}{    https://docs.djangoproject.com/en/2.0/topics/http/urls/}

\PYG{l+s+sd}{Examples:}

\PYG{l+s+sd}{Function views:}
\PYG{l+s+sd}{  1. Add an import:  from my\PYGZus{}app import views}
\PYG{l+s+sd}{  2. Add a URL to urlpatterns:  path(\PYGZsq{}\PYGZsq{}, views.home, name=\PYGZsq{}home\PYGZsq{})}

\PYG{l+s+sd}{Class\PYGZhy{}based views:}
\PYG{l+s+sd}{  1. Add an import:  from other\PYGZus{}app.views import Home}
\PYG{l+s+sd}{  2. Add a URL to urlpatterns:  path(\PYGZsq{}\PYGZsq{}, Home.as\PYGZus{}view(), name=\PYGZsq{}home\PYGZsq{})}

\PYG{l+s+sd}{Including another URLconf:}
\PYG{l+s+sd}{  1. Import the include() function: from django.urls import include, path}
\PYG{l+s+sd}{  2. Add a URL to urlpatterns:  path(\PYGZsq{}blog/\PYGZsq{}, include(\PYGZsq{}blog.urls\PYGZsq{}))}

\PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}

\PYG{k+kn}{from} \PYG{n+nn}{django.urls} \PYG{k+kn}{import} \PYG{n}{path}
\PYG{k+kn}{from} \PYG{n+nn}{.} \PYG{k+kn}{import} \PYG{n}{views}

\PYG{n}{app\PYGZus{}name} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{animals}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{urlpatterns} \PYG{o}{=} \PYG{p}{[}
\PYG{c+c1}{\PYGZsh{}    path(\PYGZsq{}\PYGZsq{}, views.AnimalIndexView.as\PYGZus{}view(), \PYGZob{}\PYGZsq{}show\PYGZsq{}:\PYGZsq{}current\PYGZsq{}\PYGZcb{}, name=\PYGZsq{}animal\PYGZhy{}list\PYGZsq{}),}
    \PYG{n}{path}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{views}\PYG{o}{.}\PYG{n}{animal\PYGZus{}list}\PYG{p}{,} \PYG{n}{name}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{animal\PYGZhy{}list}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
\PYG{c+c1}{\PYGZsh{}    path(\PYGZsq{}archive\PYGZsq{}, views.AnimalIndexView.as\PYGZus{}view(), \PYGZob{}\PYGZsq{}show\PYGZsq{}:\PYGZsq{}archive\PYGZsq{}\PYGZcb{}, name=\PYGZsq{}archive\PYGZsq{}),}
\PYG{c+c1}{\PYGZsh{}    path(\PYGZsq{}all\PYGZsq{}, views.AnimalIndexView.as\PYGZus{}view(), \PYGZob{}\PYGZsq{}show\PYGZsq{}:\PYGZsq{}all\PYGZsq{}\PYGZcb{}, name=\PYGZsq{}all\PYGZsq{}),}
    \PYG{n}{path}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{claim/\PYGZlt{}int:primary\PYGZus{}key\PYGZgt{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{views}\PYG{o}{.}\PYG{n}{claim}\PYG{p}{,} \PYG{n}{name}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{claim}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
    \PYG{n}{path}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{send\PYGZus{}email\PYGZus{}animal}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{views}\PYG{o}{.}\PYG{n}{send\PYGZus{}email\PYGZus{}animal}\PYG{p}{,} \PYG{n}{name}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{send\PYGZus{}email\PYGZus{}animal}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
    \PYG{n}{path}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{send\PYGZus{}email\PYGZus{}organ}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{views}\PYG{o}{.}\PYG{n}{send\PYGZus{}email\PYGZus{}organ}\PYG{p}{,} \PYG{n}{name}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{send\PYGZus{}email\PYGZus{}organ}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
    \PYG{n}{path}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZlt{}int:pk\PYGZgt{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{views}\PYG{o}{.}\PYG{n}{AnimalDetailView}\PYG{o}{.}\PYG{n}{as\PYGZus{}view}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{name}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{animal\PYGZhy{}detail}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
    \PYG{n}{path}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{feed}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{views}\PYG{o}{.}\PYG{n}{LatestAnimalsFeed}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{name}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{feed}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{p}{]}
\end{sphinxVerbatim}



\renewcommand{\indexname}{Index}
\printindex
\end{document}